<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.102" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"cppçŸ¥è¯†","image":[""],"dateModified":"2026-02-02T13:53:46.000Z","author":[{"@type":"Person","name":"yedou","url":"https://yedou37.github.io"}]}</script><meta property="og:url" content="https://yedou37.github.io/interview/cpp.html"><meta property="og:site_name" content="Yedou's Notebook"><meta property="og:title" content="cppçŸ¥è¯†"><meta property="og:description" content="thread_local å…³é”®å­— ç±»ï¼ˆClassï¼‰æ²¡æœ‰çº¿ç¨‹ï¼Œåªæœ‰æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰æœ‰çº¿ç¨‹ã€‚ é”™è¯¯ç†è§£ï¼šæ¯ä¸€ä¸ª FileDescriptor å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ æ­£ç¡®ç†è§£ï¼šä½ çš„ç¨‹åºå¯èƒ½å¯åŠ¨äº† 10 ä¸ªçº¿ç¨‹ï¼Œè¿™ 10 ä¸ªçº¿ç¨‹å¯èƒ½ä¼šæ“ä½œåŒä¸€ä¸ª FileDescriptor å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ“ä½œ 1000 ä¸ªä¸åŒçš„ FileDescriptor å¯¹è±¡ã€‚ static ..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2026-02-02T13:53:46.000Z"><meta property="article:modified_time" content="2026-02-02T13:53:46.000Z"><link rel="icon" href="/logo.jpg"><title>cppçŸ¥è¯† | Yedou's Notebook</title><meta name="description" content="thread_local å…³é”®å­— ç±»ï¼ˆClassï¼‰æ²¡æœ‰çº¿ç¨‹ï¼Œåªæœ‰æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰æœ‰çº¿ç¨‹ã€‚ é”™è¯¯ç†è§£ï¼šæ¯ä¸€ä¸ª FileDescriptor å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ æ­£ç¡®ç†è§£ï¼šä½ çš„ç¨‹åºå¯èƒ½å¯åŠ¨äº† 10 ä¸ªçº¿ç¨‹ï¼Œè¿™ 10 ä¸ªçº¿ç¨‹å¯èƒ½ä¼šæ“ä½œåŒä¸€ä¸ª FileDescriptor å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ“ä½œ 1000 ä¸ªä¸åŒçš„ FileDescriptor å¯¹è±¡ã€‚ static ...">
    <link rel="preload" href="/assets/style-CVnMh6PC.css" as="style"><link rel="stylesheet" href="/assets/style-CVnMh6PC.css">
    <link rel="modulepreload" href="/assets/app-EacWF1jH.js"><link rel="modulepreload" href="/assets/cpp.html-_gKsvlW1.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container no-navbar external-link-icon has-toc" vp-container><!----><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="æˆ‘çš„ç¬”è®°åº“"><!---->æˆ‘çš„ç¬”è®°åº“<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="vp-icon" icon="fa6-solid:folder-open" sizing="both" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">åŸºç¡€çŸ¥è¯†æ¦‚è§ˆ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/interview/cpp.html" aria-label="cppçŸ¥è¯†"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:code-xml" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->cppçŸ¥è¯†<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/Leetcode.html" aria-label="Leetcode"><!---->Leetcode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/network.html" aria-label="è®¡ç®—æœºç½‘ç»œ"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:network-wired" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->è®¡ç®—æœºç½‘ç»œ<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="fa6-solid:folder-open" sizing="both" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">è¯¾ç¨‹ç¬”è®°æ¦‚è§ˆ</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="fa6-solid:code-xml" sizing="height" height="1em"></iconify-icon>cppçŸ¥è¯†</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://yedou37.github.io" target="_blank" rel="noopener noreferrer">yedou</a></span><span property="author" content="yedou"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2026/1/26</span><meta property="datePublished" content="2026-01-26T09:00:21.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 10 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT10M"></span><!----><!----></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><hr><h1 id="thread-local-å…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#thread-local-å…³é”®å­—"><span>thread_local å…³é”®å­—</span></a></h1><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">size_t</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">cosnt</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> StringViewRange</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> auto&amp;&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> buffers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> thread_local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::vector</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">iovec</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> iovecs;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// buffer -&gt; iovecs</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(iovecs, total_size);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>[çº¿ç¨‹ A çš„å†…å­˜è§†è§’]</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| å¯„å­˜å™¨ fs           | ---&gt; æŒ‡å‘ TLS åŒºåŸŸ</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| TLS åŒºåŸŸ (Thread Local Storage)</span></span>
<span class="line"><span>| [ iovecs_A (24å­—èŠ‚) ] --------+</span></span>
<span class="line"><span>+---------------------+         | æŒ‡é’ˆæŒ‡å‘</span></span>
<span class="line"><span>                                v</span></span>
<span class="line"><span>                      +--------------------------+</span></span>
<span class="line"><span>                      | å † (Heap)                |</span></span>
<span class="line"><span>                      | [ iovec, iovec, ... ]    | &lt;--- è¿™é‡Œçš„å†…å­˜è¢«åå¤åˆ©ç”¨</span></span>
<span class="line"><span>                      +--------------------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-------------------------------------------------------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[çº¿ç¨‹ B çš„å†…å­˜è§†è§’]</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| å¯„å­˜å™¨ fs           | ---&gt; æŒ‡å‘ çº¿ç¨‹ B è‡ªå·±çš„ TLS</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| TLS åŒºåŸŸ</span></span>
<span class="line"><span>| [ iovecs_B (24å­—èŠ‚) ] --------+</span></span>
<span class="line"><span>+---------------------+         | æŒ‡é’ˆæŒ‡å‘ä¸åŒçš„å †åœ°å€</span></span>
<span class="line"><span>                                v</span></span>
<span class="line"><span>                      +--------------------------+</span></span>
<span class="line"><span>                      | å † (Heap)                |</span></span>
<span class="line"><span>                      | [ iovec, iovec, ... ]    |</span></span>
<span class="line"><span>                      +--------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç±»ï¼ˆClassï¼‰æ²¡æœ‰çº¿ç¨‹ï¼Œåªæœ‰æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰æœ‰çº¿ç¨‹ã€‚</strong></p><ul><li><p><strong>é”™è¯¯ç†è§£</strong>ï¼šæ¯ä¸€ä¸ªÂ FileDescriptorÂ å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹</p></li><li><p><strong>æ­£ç¡®ç†è§£</strong>ï¼šä½ çš„ç¨‹åºå¯èƒ½å¯åŠ¨äº† 10 ä¸ªçº¿ç¨‹ï¼Œè¿™ 10 ä¸ªçº¿ç¨‹å¯èƒ½ä¼šæ“ä½œåŒä¸€ä¸ªÂ FileDescriptorÂ å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ“ä½œ 1000 ä¸ªä¸åŒçš„Â FileDescriptorÂ å¯¹è±¡ã€‚<br><strong>static thread_localÂ çš„å«ä¹‰æ˜¯ï¼š</strong><br> ä¸ç®¡ä½ åˆ›å»ºäº†å¤šå°‘ä¸ªÂ FileDescriptorÂ å¯¹è±¡ï¼ˆå“ªæ€• 1 ä¸‡ä¸ªï¼‰ï¼Œ<strong>åªè¦å®ƒä»¬æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼ˆThread Aï¼‰é‡Œè¿è¡Œçš„Â writeÂ å‡½æ•°ï¼Œå®ƒä»¬å°±å…±äº«åŒä¸€ä¸ªÂ iovecsÂ å˜é‡ã€‚</strong></p></li><li><p><strong>åœºæ™¯ 1</strong>ï¼šçº¿ç¨‹ A é‡Œçš„Â socket1Â è°ƒäº†Â writeï¼Œæ¥ç€Â socket2Â ä¹Ÿè°ƒäº†Â writeã€‚</p><ul><li>ç»“æœï¼šsocket2Â ä¼š<strong>å¤ç”¨</strong>Â socket1Â åˆšåˆšç”¨è¿‡çš„é‚£å—å†…å­˜ï¼ˆå‰ææ˜¯Â socket1Â ç”¨å®Œå vector è¢« clear äº†ï¼Œä½† capacity è¿˜åœ¨ï¼‰ã€‚æ•ˆç‡æé«˜ï¼</li></ul></li><li><p><strong>åœºæ™¯ 2</strong>ï¼šçº¿ç¨‹ A é‡Œçš„Â socket1Â å’Œçº¿ç¨‹ B é‡Œçš„Â socket1Â åŒæ—¶è°ƒÂ writeã€‚</p><ul><li>ç»“æœï¼šçº¿ç¨‹ A ç”¨çš„æ˜¯Â iovecs_Aï¼Œçº¿ç¨‹ B ç”¨çš„æ˜¯Â iovecs_Bã€‚äº’ä¸å¹²æ‰°ï¼Œä¸éœ€è¦åŠ é”ã€‚</li></ul></li><li><p><strong>å‡ºç”Ÿï¼ˆæ„é€ ï¼‰</strong>ï¼š</p><ul><li>å½“<strong>æŸä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡</strong>è¿è¡Œåˆ°Â writeÂ å‡½æ•°å†…éƒ¨çš„é‚£ä¸€è¡Œä»£ç æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸“å±çš„Â iovecsÂ è¢«æ„é€ ã€‚</li><li>å¦‚æœä½ æœ‰ 10 ä¸ªçº¿ç¨‹ï¼Œä½†åªæœ‰ 3 ä¸ªçº¿ç¨‹è°ƒç”¨è¿‡Â writeï¼Œé‚£å°±åªæœ‰ 3 ä¸ªÂ iovecsÂ è¢«åˆ›å»ºã€‚</li></ul></li><li><p><strong>å­˜æ´»</strong>ï¼š</p><ul><li>åªè¦è¿™ä¸ª<strong>çº¿ç¨‹</strong>è¿˜æ´»ç€ï¼Œè¿™ä¸ªå˜é‡å°±ä¸€ç›´æ´»ç€ï¼ˆä¿ç•™ç€å †å†…å­˜ï¼‰ã€‚</li><li>å®ƒ<strong>ä¸éšå¯¹è±¡çš„é”€æ¯è€Œé”€æ¯</strong>ã€‚å³ä½¿ä½ æŠŠæ‰€æœ‰çš„Â FileDescriptorÂ å¯¹è±¡éƒ½ææ„äº†ï¼Œåªè¦çº¿ç¨‹è¿˜åœ¨ï¼Œè¿™ä¸ªÂ iovecsÂ ä¾ç„¶å ç€å†…å­˜ç­‰å¾…ä¸‹ä¸€æ¬¡å¬å”¤ã€‚</li></ul></li><li><p><strong>æ­»äº¡ï¼ˆææ„ï¼‰</strong>ï¼š</p><ul><li>å½“<strong>çº¿ç¨‹é€€å‡ºï¼ˆThread Exitï¼‰</strong> æ—¶ã€‚</li><li>C++ è¿è¡Œæ—¶ç¯å¢ƒä¼šè‡ªåŠ¨éå†è¯¥çº¿ç¨‹æ‰€æœ‰çš„Â thread_localÂ å˜é‡ï¼Œè°ƒç”¨å®ƒä»¬çš„ææ„å‡½æ•°ï¼Œä»è€Œé‡Šæ”¾é‚£å—å †å†…å­˜ï¼Œæœ€åæ¸…ç† TLS é‡Œçš„å¤´ä¿¡æ¯ã€‚</li></ul></li></ul><h3 id="static-æ˜¯ä»€ä¹ˆæ„æ€-åœ¨å‡½æ•°å†…éƒ¨" tabindex="-1"><a class="header-anchor" href="#static-æ˜¯ä»€ä¹ˆæ„æ€-åœ¨å‡½æ•°å†…éƒ¨"><span>staticÂ æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿï¼ˆåœ¨å‡½æ•°å†…éƒ¨ï¼‰</span></a></h3><p>å½“Â staticÂ ç”¨äºå‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡æ—¶ï¼Œå®ƒæ”¹å˜çš„æ˜¯å˜é‡çš„Â <strong>ç”Ÿå‘½å‘¨æœŸï¼ˆLifecycleï¼‰</strong>Â å’ŒÂ <strong>å­˜å‚¨ä½ç½®</strong>ã€‚</p><ul><li><strong>æ™®é€šå±€éƒ¨å˜é‡</strong>Â (int a = 0;) <ul><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šæ ˆï¼ˆStackï¼‰ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šå‡½æ•°è¢«è°ƒç”¨æ—¶åˆ›å»ºï¼Œå‡½æ•°è¿”å›æ—¶é”€æ¯ã€‚ä¸‹æ¬¡è°ƒç”¨æ—¶æ˜¯å…¨æ–°çš„ã€‚</li><li><strong>æ¯”å–»</strong>ï¼šä¾¿åˆ©è´´ã€‚ç”¨å®Œå°±æ’•äº†æ‰”æ‰ã€‚</li></ul></li><li><strong>é™æ€å±€éƒ¨å˜é‡</strong>Â (static int a = 0;)ï¼š <ul><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šæ•°æ®æ®µï¼ˆData Segment / BSSï¼‰ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š<strong>æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´</strong>ã€‚å®ƒåœ¨ç¨‹åºç¬¬ä¸€æ¬¡è¿è¡Œåˆ°è¿™è¡Œä»£ç æ—¶åˆå§‹åŒ–ï¼Œç›´åˆ°ç¨‹åºç»“æŸæ‰é”€æ¯ã€‚</li><li><strong>æ¯”å–»</strong>ï¼šå¢™ä¸Šçš„ç™½æ¿ã€‚ä½ å†™äº†å­—ï¼Œç¦»å¼€æˆ¿é—´å†å›æ¥ï¼Œå­—è¿˜åœ¨é‚£é‡Œã€‚</li></ul></li></ul><hr><h3 id="thread-local-æ˜¯ä»€ä¹ˆæ„æ€" tabindex="-1"><a class="header-anchor" href="#thread-local-æ˜¯ä»€ä¹ˆæ„æ€"><span>thread_localÂ æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</span></a></h3><p>å®ƒæ”¹å˜çš„æ˜¯å˜é‡çš„Â <strong>å®ä¾‹æ•°é‡</strong>Â å’ŒÂ <strong>å½’å±æƒ</strong>ã€‚</p><ul><li><strong>æ²¡æœ‰ thread_local</strong>ï¼š <ul><li>å…¨å±€åªæœ‰ä¸€ä»½ï¼ˆå¦‚æœæ˜¯ staticï¼‰ã€‚æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œæ”¹çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªã€‚</li><li><strong>åæœ</strong>ï¼šå¤šçº¿ç¨‹åŒæ—¶æ”¹ä¼šæ‰“æ¶ï¼ˆData Raceï¼‰ï¼Œå¿…é¡»åŠ é”ã€‚</li></ul></li><li><strong>æœ‰ thread_local</strong>ï¼š <ul><li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä»½ç‹¬ç«‹çš„æ‹·è´ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š<strong>ä¸çº¿ç¨‹ç»‘å®š</strong>ã€‚çº¿ç¨‹å¯åŠ¨ï¼ˆæˆ–ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼‰æ—¶åˆ›å»ºï¼Œçº¿ç¨‹ç»“æŸæ—¶é”€æ¯ã€‚</li></ul></li></ul><hr><h1 id="std-unique-ptr-std-make-unique" tabindex="-1"><a class="header-anchor" href="#std-unique-ptr-std-make-unique"><span><code>std::unique_ptr&lt;&gt; std::make_unique&lt;&gt;()</code></span></a></h1><ol><li><strong><code>std::unique_ptr</code>Â (éœ¸é“æ€»è£)</strong>ï¼š <ul><li>å®ƒæ˜¯<strong>ç®¡ç†è€…</strong>ã€‚</li><li>å®ƒçš„åº§å³é“­æ˜¯ï¼šâ€œ<strong>è¿™å—å†…å­˜æ˜¯æˆ‘çš„ï¼Œåªèƒ½æ˜¯æˆ‘çš„ï¼Œè°ä¹Ÿåˆ«æƒ³å¤åˆ¶ï¼Œä½†æˆ‘æ­»äº†è¿™å—å†…å­˜ä¹Ÿåˆ«æƒ³æ´»ã€‚</strong>â€</li><li>å®ƒé€šè¿‡ RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰æœºåˆ¶ï¼Œä¿è¯å‡ºäº†ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚</li></ul></li><li><strong><code>std::make_unique</code>Â (ä¸“å±å·¥å‚)</strong>ï¼š <ul><li>å®ƒæ˜¯<strong>ç”Ÿäº§è€…</strong>ã€‚</li><li>å®ƒçš„ä½œç”¨æ˜¯ï¼šâ€œ<strong>åˆ«è‡ªå·±çæŠ˜è…¾å»Â newÂ äº†ï¼ŒæŠŠè¦æ±‚å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¸®ä½ é€ å¥½æ‰“åŒ…é€ç»™ä½ ã€‚</strong>â€</li><li>å®ƒæ˜¯ C++14 å¼•å…¥çš„è¾…åŠ©å‡½æ•°ï¼Œç”¨æ¥ç”ŸæˆÂ <code>unique_ptr</code>ã€‚<br> ç‹¬å æ‰€æœ‰æƒ-&gt;ä¸èƒ½æ‹·è´ åªèƒ½ç§»åŠ¨<br> é›¶å¼€é”€</li></ul></li></ol><ul><li>unique_ptrÂ å†…éƒ¨åªå­˜äº†ä¸€ä¸ªè£¸æŒ‡é’ˆã€‚</li><li>å¦‚æœä½ ä¸ä½¿ç”¨è‡ªå®šä¹‰åˆ é™¤å™¨ï¼ˆDeleterï¼‰ï¼Œå®ƒçš„å¤§å°å’ŒÂ int*Â å®Œå…¨ä¸€æ ·ï¼ˆ64ä½ç³»ç»Ÿä¸‹å°±æ˜¯ 8 å­—èŠ‚ï¼‰ã€‚</li><li>å®ƒçš„è§£å¼•ç”¨æ“ä½œÂ *ptrÂ å’ŒÂ ptr-&gt;Â ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–æˆå’Œè£¸æŒ‡é’ˆä¸€æ¨¡ä¸€æ ·çš„æ±‡ç¼–æŒ‡ä»¤</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">process</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">std</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()), std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>C++ ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™è¡Œä»£ç æ—¶ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼ˆUnspecified Evaluation Orderï¼‰ã€‚å®ƒå¯èƒ½è¿™æ ·æ‰§è¡Œï¼š</p><ol><li>new A()Â åˆ†é…æˆåŠŸã€‚</li><li><strong>æ‰§è¡ŒÂ new B()Â â€”â€” æ­¤æ—¶å†…å­˜ä¸è¶³æŠ›å‡ºå¼‚å¸¸ï¼</strong></li><li><code>std::unique_ptr&lt;A&gt;</code>Â çš„æ„é€ å‡½æ•°è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œã€‚</li><li><strong>ç»“æœ</strong>ï¼šAÂ çš„æŒ‡é’ˆä¸¢å¤±äº†ï¼Œæ²¡äººè´Ÿè´£Â deleteÂ å®ƒï¼Œ<strong>å†…å­˜æ³„æ¼</strong>ã€‚</li></ol><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">process</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">std</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make_unique</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(), std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make_unique</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>make_uniqueÂ å†…éƒ¨å°è£…äº†Â newÂ å’ŒÂ unique_ptrÂ çš„æ„é€ ã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„å‡½æ•°è°ƒç”¨ã€‚<br> è¿™æ„å‘³ç€æ­¥éª¤å˜æˆäº†ï¼š</p><ol><li>å®Œæ•´æ‰§è¡ŒÂ <code>make_unique&lt;A&gt;()</code>ï¼ˆåˆ†é…+åŒ…è£…ï¼‰ã€‚æˆåŠŸåè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</li><li>å®Œæ•´æ‰§è¡ŒÂ <code>make_unique&lt;B&gt;()</code>ã€‚</li><li><strong>å¦‚æœ B å¤±è´¥äº†ï¼ŒA å·²ç»æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆå¯¹è±¡äº†ï¼Œå®ƒä¼šè‡ªåŠ¨ææ„é‡Šæ”¾å†…å­˜ã€‚</strong></li><li><strong>ç»“è®ºï¼šé›¶æ³„æ¼é£é™©ã€‚</strong></li></ol><h1 id="ä½¿ç”¨å·¥å‚å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨å·¥å‚å‡½æ•°"><span>ä½¿ç”¨å·¥å‚å‡½æ•°</span></a></h1><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹å¼1ï¼šä¸ä½¿ç”¨å·¥å‚å‡½æ•°ï¼ˆå¤æ‚ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TypeId</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int32_t</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) : </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">type_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(type), </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(value) {}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TypeId</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) : </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">type_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(type) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å¤æ‚çš„å­—ç¬¦ä¸²å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å†…å­˜ç®¡ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TypeId</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">bool</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) : </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">type_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(type), </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;">static_cast</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;int8_t&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(value)) {}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ—¶éœ€è¦è®°ä½å¤æ‚çš„æ„é€ æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> int_val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(TypeId::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INTEGER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">42</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> bool_val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(TypeId::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">BOOLEAN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">static_cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int8_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // éœ€è¦æ‰‹åŠ¨è½¬æ¢</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹å¼2ï¼šä½¿ç”¨å·¥å‚å‡½æ•°ï¼ˆç®€æ´ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ValueFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> inline</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> auto</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GetIntegerValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int32_t</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) -&gt; </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {TypeId::INTEGER, value};</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> inline</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> auto</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GetBooleanValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">bool</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) -&gt; </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {TypeId::BOOLEAN, </span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;">static_cast</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;int8_t&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(value)};</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ—¶éå¸¸ç®€å•ç›´è§‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Value int_val </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ValueFactory::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GetIntegerValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">42</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Value bool_val </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ValueFactory::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GetBooleanValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å·¥å‚å‡½æ•°ä¸€èˆ¬éƒ½ä½¿ç”¨static å› ä¸ºè¿™æ ·å‡½æ•°åªå±äºè¿™ä¸ªå·¥å‚ç±»æœ¬èº« ä¸éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªValueFactoryå¯¹è±¡ èƒ½å¤Ÿç›´æ¥é€šè¿‡è¿™ä¸ªç±»åè¿›è¡Œè°ƒç”¨ è€Œä¸”å¯ä»¥åœ¨å…¨å±€èŒƒå›´å†…è¿›è¡Œè®¿é—®<br> ä¼˜ç‚¹</p><ul><li>èƒ½å¤Ÿç»Ÿä¸€æ¥å£</li><li>æ˜“äºæ‰©å±• å¦‚æœéœ€è¦æ”¯æŒæ–°çš„ç±»åˆ«çš„è¯ ç›´æ¥åœ¨å·¥å‚ä¸­æ·»åŠ æ–°æ–¹æ³•å³å¯</li><li>éšè—å¤æ‚åº¦</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">protected:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> y</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) : </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">type_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(type), </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">x_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x), </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">y_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(y) {}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CreatePlayer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> y</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> player </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;player&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, x, y));</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setHealth</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setSpeed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> player;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CreateEnemy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> y</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> enemy </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;enemy&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, x, y));</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        enemy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setHealth</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        enemy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setSpeed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        enemy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setAggressive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> enemy;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CreateItem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> y</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> itemType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> item </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unique_ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GameObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, x, y));</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setItemProperties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(itemType);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> item;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> player </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> GameObject::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CreatePlayer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> enemy </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> GameObject::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CreateEnemy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> potion </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> GameObject::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CreateItem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;health_potion&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å¦‚è¿™é‡Œéƒ½æ˜¯åˆ›å»ºæ¸¸æˆä¸­çš„å¯¹è±¡ å¯ä»¥ä½¿ç”¨å·¥å‚å‡½æ•° æ›´åŠ ç®€å•ç›´è§‚åœ°è¿›è¡Œæ„é€ </p><h1 id="top-k" tabindex="-1"><a class="header-anchor" href="#top-k"><span>TOP-K</span></a></h1><hr><h3 id="_1-åœºæ™¯ä¸€-å•æœºå†…å­˜å¤„ç†-static-data-fit-in-memory" tabindex="-1"><a class="header-anchor" href="#_1-åœºæ™¯ä¸€-å•æœºå†…å­˜å¤„ç†-static-data-fit-in-memory"><span>1. åœºæ™¯ä¸€ï¼šå•æœºå†…å­˜å¤„ç†ï¼ˆStatic Data, Fit in Memoryï¼‰</span></a></h3><p>å‡è®¾ç»™ä½ ä¸€ä¸ªåŒ…å« <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> ä¸ªæ•´æ•°çš„æ•°ç»„ï¼Œå†…å­˜æ”¾å¾—ä¸‹ï¼Œæ‰¾å‡ºæœ€å¤§çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªã€‚</p><h4 id="æ–¹æ³•-a-å…¨é‡æ’åº-naive-approach" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-a-å…¨é‡æ’åº-naive-approach"><span>æ–¹æ³• Aï¼šå…¨é‡æ’åº (Naive Approach)</span></a></h4><ul><li><strong>åšæ³•</strong>ï¼šä½¿ç”¨ <code>std::sort</code> (QuickSort/MergeSort) å°†æ•°ç»„å®Œå…¨æ’åºï¼Œç„¶åå–å‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªã€‚</li><li><strong>å¤æ‚åº¦</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mi>log</mi><mo>â¡</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N \log N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>ã€‚</li><li><strong>è¯„ä»·</strong>ï¼š<strong>æœ€å·®</strong>ã€‚å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> å¾ˆå¤§è€Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> å¾ˆå°æ—¶ï¼ˆä¾‹å¦‚ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>1000</mn><mtext>ä¸‡</mtext><mo separator="true">,</mo><mi>K</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">N=1000ä¸‡, K=10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">1000</span><span class="mord cjk_fallback">ä¸‡</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span>ï¼‰ï¼Œåšäº†å¤§é‡æ— ç”¨åŠŸã€‚</li></ul><h4 id="æ–¹æ³•-b-æœ€å°å †-min-heap-â€”â€”-å·¥ç¨‹é¦–é€‰" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-b-æœ€å°å †-min-heap-â€”â€”-å·¥ç¨‹é¦–é€‰"><span>æ–¹æ³• Bï¼šæœ€å°å † (Min-Heap) â€”â€” <strong>å·¥ç¨‹é¦–é€‰</strong></span></a></h4><ul><li><strong>åšæ³•</strong>ï¼š <ol><li>ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> çš„<strong>å°é¡¶å †</strong>ã€‚</li><li>éå†æ•°ç»„ï¼Œå°†å…ƒç´ å‹å…¥å †ã€‚</li><li>å¦‚æœå †çš„å¤§å°è¶…è¿‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>ï¼Œå¼¹å‡ºå †é¡¶ï¼ˆå³å †ä¸­æœ€å°çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å½“å‰ Top K é‡Œæœ€å¼±çš„é‚£ä¸ªï¼‰ã€‚</li><li>æœ€ç»ˆå †é‡Œå‰©ä¸‹çš„å°±æ˜¯æœ€å¤§çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªã€‚</li></ol></li><li><strong>å¤æ‚åº¦</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mi>log</mi><mo>â¡</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N \log K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span>ã€‚</li><li><strong>è¯„ä»·</strong>ï¼š<strong>æœ€é€šç”¨ã€æœ€ç¨³å¥</strong>ã€‚ç‰¹åˆ«æ˜¯å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>â‰ª</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">K \ll N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰ª</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> æ—¶ï¼Œæ•ˆç‡æé«˜ã€‚ä½ ä¼˜åŒ–åçš„ä»£ç ç”¨çš„å°±æ˜¯è¿™ä¸ªã€‚</li></ul><h4 id="æ–¹æ³•-c-å¿«é€Ÿé€‰æ‹©-quick-select-â€”â€”-å¹³å‡æœ€å¿«" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-c-å¿«é€Ÿé€‰æ‹©-quick-select-â€”â€”-å¹³å‡æœ€å¿«"><span>æ–¹æ³• Cï¼šå¿«é€Ÿé€‰æ‹© (Quick Select) â€”â€” <strong>å¹³å‡æœ€å¿«</strong></span></a></h4><ul><li><strong>åšæ³•</strong>ï¼šåŸºäºå¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰çš„ Partition æ€æƒ³ã€‚ <ol><li>éšæœºé€‰ä¸€ä¸ª Pivotï¼Œå°†æ•°ç»„åˆ†ä¸ºâ€œæ¯” Pivot å¤§â€å’Œâ€œæ¯” Pivot å°â€ä¸¤éƒ¨åˆ†ã€‚</li><li>çœ‹ Pivot çš„ä½ç½®ï¼š <ul><li>å¦‚æœ Pivot æ­£å¥½åœ¨ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªä½ç½®ï¼Œé‚£ä¹ˆå®ƒå·¦è¾¹çš„å°±æ˜¯ Top Kã€‚</li><li>å¦‚æœ Pivot åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¹‹åï¼Œé€’å½’å¤„ç†å·¦è¾¹ã€‚</li><li>å¦‚æœ Pivot åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¹‹å‰ï¼Œé€’å½’å¤„ç†å³è¾¹ã€‚</li></ul></li></ol></li><li><strong>å¤æ‚åº¦</strong>ï¼šå¹³å‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>ï¼Œæœ€å <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ã€‚</li><li><strong>è¯„ä»·</strong>ï¼š<strong>ç†è®ºæœ€å¿«</strong>ï¼Œä½†ä¿®æ”¹äº†åŸæ•°ç»„ï¼Œä¸”ä¸ç¨³å®šã€‚C++ æ ‡å‡†åº“ä¸­æœ‰ <code>std::nth_element</code> å°±æ˜¯è¿™ä¸ªå®ç°ã€‚</li></ul><hr><h3 id="_2-åœºæ™¯äºŒ-æµ·é‡æ•°æ®-æµå¼æ•°æ®-streaming-data" tabindex="-1"><a class="header-anchor" href="#_2-åœºæ™¯äºŒ-æµ·é‡æ•°æ®-æµå¼æ•°æ®-streaming-data"><span>2. åœºæ™¯äºŒï¼šæµ·é‡æ•°æ®/æµå¼æ•°æ®ï¼ˆStreaming Dataï¼‰</span></a></h3><p>å‡è®¾æ•°æ®æ˜¯å®æ—¶æµè¿›æ¥çš„ï¼ˆåƒç½‘ç»œåŒ…ã€æ—¥å¿—ï¼‰ï¼Œæˆ–è€…æ•°æ®åœ¨ç£ç›˜ä¸Šï¼Œå†…å­˜æ”¾ä¸ä¸‹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> ä¸ªå…ƒç´ ã€‚</p><ul><li><strong>é™åˆ¶</strong>ï¼šæ— æ³•å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ï¼Œæ— æ³•ä½¿ç”¨ Quick Selectã€‚</li><li><strong>å”¯ä¸€è§£æ³•ï¼šæœ€å°å † (Min-Heap)</strong>ã€‚ <ul><li><strong>åŸç†</strong>ï¼šä¸ç®¡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> æœ‰å¤šå¤§ï¼ˆ1TB ç”šè‡³æ— ç©·å¤§ï¼‰ï¼Œå†…å­˜ä¸­åªéœ€è¦ç»´æŠ¤ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> å¤§å°çš„å †ã€‚</li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span>ã€‚</li></ul></li><li><strong>åº”ç”¨</strong>ï¼šå®æ—¶çƒ­æœæ¦œã€DDOS æ”»å‡»æ£€æµ‹ï¼ˆæµé‡æœ€å¤§çš„ K ä¸ª IPï¼‰ã€‚</li></ul><hr><h3 id="_3-åœºæ™¯ä¸‰-åˆ†å¸ƒå¼å¤§æ•°æ®-distributed-big-data" tabindex="-1"><a class="header-anchor" href="#_3-åœºæ™¯ä¸‰-åˆ†å¸ƒå¼å¤§æ•°æ®-distributed-big-data"><span>3. åœºæ™¯ä¸‰ï¼šåˆ†å¸ƒå¼å¤§æ•°æ®ï¼ˆDistributed / Big Dataï¼‰</span></a></h3><p>å‡è®¾æœ‰ 10 äº¿è¡Œæ•°æ®ï¼Œåˆ†å¸ƒåœ¨ 1000 å°æœºå™¨ä¸Šï¼Œè¦æ‰¾å…¨å±€ Top-Kã€‚</p><ul><li><strong>é™åˆ¶</strong>ï¼šå•æœºç®—ä¸åŠ¨ï¼Œç½‘ç»œå¸¦å®½æœ‰é™ã€‚</li><li><strong>è§£æ³•ï¼šåˆ†æ²»æ³• (MapReduce æ€æƒ³)</strong><ol><li><strong>Map é˜¶æ®µ</strong>ï¼šæ¯å°æœºå™¨åœ¨æœ¬åœ°æ•°æ®ä¸Šè®¡ç®—<strong>å±€éƒ¨ Top-K</strong>ï¼ˆä½¿ç”¨å †ï¼‰ã€‚</li><li><strong>Reduce é˜¶æ®µ</strong>ï¼šæ¯å°æœºå™¨å°†è¿™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªå…ƒç´ å‘é€ç»™ä¸€å°ä¸­å¿ƒæœºå™¨ï¼ˆæˆ–è€…ä¸‹ä¸€å±‚èšåˆèŠ‚ç‚¹ï¼‰ã€‚</li><li><strong>Merge é˜¶æ®µ</strong>ï¼šä¸­å¿ƒæœºå™¨æ”¶é›†åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1000</mn><mo>Ã—</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">1000 \times K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1000</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªå…ƒç´ ï¼Œå†åšä¸€æ¬¡ Top-Kï¼Œå¾—åˆ°å…¨å±€ Top-Kã€‚</li></ol></li><li><strong>å…³é”®ç‚¹</strong>ï¼šä¼ è¾“çš„æ•°æ®é‡éå¸¸å°ï¼ˆåªæœ‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>ï¼‰ï¼Œè€Œä¸æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>ã€‚</li></ul><hr><h3 id="_4-åœºæ™¯å››-ç»Ÿè®¡-é¢‘ç‡-æœ€é«˜çš„-top-k-heavy-hitters" tabindex="-1"><a class="header-anchor" href="#_4-åœºæ™¯å››-ç»Ÿè®¡-é¢‘ç‡-æœ€é«˜çš„-top-k-heavy-hitters"><span>4. åœºæ™¯å››ï¼šç»Ÿè®¡â€œé¢‘ç‡â€æœ€é«˜çš„ Top-K (Heavy Hitters)</span></a></h3><p>ä¸Šé¢çš„åœºæ™¯éƒ½æ˜¯åŸºäºå…ƒç´ çš„å€¼ï¼ˆValueï¼‰æ’åºã€‚å¦‚æœé—®é¢˜æ˜¯ï¼š<strong>â€œåœ¨ä¸€ä¸ª 100GB çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ‰¾å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„ 10 ä¸ª IP åœ°å€â€</strong>ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªéš¾ç‚¹ï¼Œå› ä¸ºä½ ä¸ä»…è¦æ’åºï¼Œè¿˜è¦å…ˆ<strong>ç»Ÿè®¡è®¡æ•°</strong>ã€‚</p><h4 id="æ–¹æ³•-a-hash-map-heap-ç²¾ç¡®è§£" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-a-hash-map-heap-ç²¾ç¡®è§£"><span>æ–¹æ³• Aï¼šHash Map + Heap (ç²¾ç¡®è§£)</span></a></h4><ul><li><strong>åšæ³•</strong>ï¼šç”¨ Hash Map ç»Ÿè®¡æ‰€æœ‰ IP çš„å‡ºç°æ¬¡æ•°ï¼Œç„¶åæŠŠ (IP, Count) æ‰”è¿›å †é‡Œæ±‚ Top-Kã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœæœ‰ 10 äº¿ä¸ªä¸åŒçš„ IPï¼ŒHash Map å†…å­˜ä¼šçˆ†ç‚¸ã€‚</li></ul><h4 id="æ–¹æ³•-b-hash-åˆ†ç‰‡-ç²¾ç¡®è§£-åˆ†å¸ƒå¼" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-b-hash-åˆ†ç‰‡-ç²¾ç¡®è§£-åˆ†å¸ƒå¼"><span>æ–¹æ³• Bï¼šHash åˆ†ç‰‡ (ç²¾ç¡®è§£ï¼Œåˆ†å¸ƒå¼)</span></a></h4><ul><li><strong>åšæ³•</strong>ï¼š <ol><li>æŠŠ IP æŒ‰ç…§ <code>hash(IP) % 1024</code> åˆ†å‘åˆ° 1024 ä¸ªå°æ–‡ä»¶ä¸­ã€‚</li><li>è¿™æ ·ç›¸åŒçš„ IP è‚¯å®šåœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œã€‚</li><li>åˆ†åˆ«åŠ è½½æ¯ä¸ªå°æ–‡ä»¶åˆ°å†…å­˜ï¼Œç”¨ Hash Map ç»Ÿè®¡å¹¶æ±‚å±€éƒ¨ Top-Kã€‚</li><li>æœ€åå½’å¹¶ã€‚</li></ol></li></ul><h4 id="æ–¹æ³•-c-count-min-sketch-misra-gries-è¿‘ä¼¼è§£" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-c-count-min-sketch-misra-gries-è¿‘ä¼¼è§£"><span>æ–¹æ³• Cï¼šCount-Min Sketch / Misra-Gries (è¿‘ä¼¼è§£)</span></a></h4><ul><li><strong>åœºæ™¯</strong>ï¼šå…è®¸ä¸€ç‚¹ç‚¹è¯¯å·®ï¼Œä½†å¿…é¡»æçœå†…å­˜ï¼ˆæ¯”å¦‚è·¯ç”±å™¨ç¡¬ä»¶ï¼‰ã€‚</li><li><strong>åšæ³•</strong>ï¼šä½¿ç”¨æ¦‚ç‡æ•°æ®ç»“æ„ï¼ˆå¦‚ Count-Min Sketchï¼‰ã€‚ <ul><li>ç”¨å¤šä¸ª Hash å‡½æ•°å°†å…ƒç´ æ˜ å°„åˆ°äºŒç»´æ•°ç»„ä¸­è¿›è¡Œè®¡æ•°ã€‚</li><li>ä¸éœ€è¦å­˜å‚¨ IP æœ¬èº«ï¼Œåªå­˜å‚¨è®¡æ•°å€¼ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šç”¨æå°çš„ç©ºé—´ï¼ˆå‡ KBï¼‰å°±èƒ½ç»Ÿè®¡æµ·é‡æ•°æ®ã€‚</li></ul></li></ul><hr><h3 id="_5-æ•°æ®åº“ä¸­çš„-top-k-ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_5-æ•°æ®åº“ä¸­çš„-top-k-ä¼˜åŒ–"><span>5. æ•°æ®åº“ä¸­çš„ Top-K ä¼˜åŒ–</span></a></h3><p><code>SELECT * FROM table ORDER BY col LIMIT K</code>ã€‚</p><p>æ•°æ®åº“ä¼˜åŒ–å™¨é€šå¸¸ä¼šæŒ‰ä»¥ä¸‹é¡ºåºå°è¯•ï¼š</p><ol><li><p><strong>åˆ©ç”¨ç´¢å¼• (Index Scan)</strong>ï¼š</p><ul><li>å¦‚æœåœ¨ <code>col</code> ä¸Šæœ‰ B+ æ ‘ç´¢å¼•ï¼Œç´¢å¼•æœ¬èº«å°±æ˜¯æœ‰åºçš„ã€‚</li><li>æ•°æ®åº“åªéœ€è¦è¯»ç´¢å¼•çš„æœ€å·¦è¾¹ï¼ˆæˆ–æœ€å³è¾¹ï¼‰çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªæ¡ç›®ã€‚</li><li><strong>å¤æ‚åº¦</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span>ã€‚è¿™æ˜¯æé€Ÿæ¨¡å¼ã€‚</li></ul></li><li><p>**Top-N Heap Sortï¼š</p><ul><li>å¦‚æœæ²¡ç´¢å¼•ï¼Œå¿…é¡»å…¨è¡¨æ‰«æã€‚</li><li>åœ¨æ‰«æè¿‡ç¨‹ä¸­ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> çš„å †ã€‚</li><li><strong>å¤æ‚åº¦</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mi>log</mi><mo>â¡</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N \log K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span>ã€‚</li></ul></li><li><p><strong>å…¨é‡æ’åº (External Sort)</strong>ï¼š</p><ul><li>å¦‚æœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> éå¸¸å¤§ï¼ˆæ¯”å¦‚ <code>LIMIT 1000000</code>ï¼‰ï¼Œå †å¤ªå¤§å†…å­˜æ”¾ä¸ä¸‹ã€‚</li><li>é€€åŒ–ä¸ºå¤–éƒ¨å½’å¹¶æ’åºã€‚</li></ul></li></ol><h3 id="æ€»ç»“è¡¨" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“è¡¨"><span>æ€»ç»“è¡¨</span></a></h3><table><thead><tr><th style="text-align:left;">åœºæ™¯</th><th style="text-align:left;">æœ€ä½³ç­–ç•¥</th><th style="text-align:left;">å¤æ‚åº¦</th><th style="text-align:left;">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>å†…å­˜å……è¶³ï¼Œé™æ€æ•°æ®</strong></td><td style="text-align:left;"><strong>Quick Select</strong></td><td style="text-align:left;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></td><td style="text-align:left;">ä¼šä¿®æ”¹åŸæ•°ç»„</td></tr><tr><td style="text-align:left;"><strong>å†…å­˜å……è¶³ï¼Œä¸€èˆ¬é€šç”¨</strong></td><td style="text-align:left;"><strong>Min-Heap</strong></td><td style="text-align:left;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mi>log</mi><mo>â¡</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N \log K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span></td><td style="text-align:left;">ä¸æ”¹åŸæ•°ç»„ï¼Œç¨³å®š</td></tr><tr><td style="text-align:left;"><strong>æµå¼æ•°æ® (Streaming)</strong></td><td style="text-align:left;"><strong>Min-Heap</strong></td><td style="text-align:left;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mi>log</mi><mo>â¡</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N \log K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span></td><td style="text-align:left;">ç©ºé—´ä»…éœ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span></td></tr><tr><td style="text-align:left;"><strong>æµ·é‡æ•°æ® (åˆ†å¸ƒå¼)</strong></td><td style="text-align:left;"><strong>åˆ†æ²» + å½’å¹¶</strong></td><td style="text-align:left;">-</td><td style="text-align:left;">MapReduce ç»å…¸æ¡ˆä¾‹</td></tr><tr><td style="text-align:left;"><strong>é«˜é¢‘è¯ç»Ÿè®¡ (ç²¾ç¡®)</strong></td><td style="text-align:left;"><strong>Hashåˆ†ç‰‡ + Heap</strong></td><td style="text-align:left;">-</td><td style="text-align:left;">è§£å†³ Map å†…å­˜çˆ†ç‚¸é—®é¢˜</td></tr><tr><td style="text-align:left;"><strong>é«˜é¢‘è¯ç»Ÿè®¡ (è¿‘ä¼¼)</strong></td><td style="text-align:left;"><strong>Count-Min Sketch</strong></td><td style="text-align:left;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> ç©ºé—´</td><td style="text-align:left;">ç‰ºç‰²ç²¾åº¦æ¢ç©ºé—´</td></tr></tbody></table></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/yedou37/yedou37.github.io/edit/main/src/interview/cpp.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">æœ€è¿‘æ›´æ–°: </span><time class="vp-meta-info" datetime="2026-02-02T13:53:46.000Z" data-allow-mismatch>2026/2/2 13:53</time></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 137401103+yedou37@users.noreply.github.com">yedou37</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/interview/Leetcode.html" aria-label="Leetcode"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Leetcode<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">è®°å½•é¢è¯•å¤ä¹  & è¯¾ç¨‹å¤§ä½œä¸š</div><div class="vp-copyright">Copyright Â© 2026 yedou </div></footer></div><!--]--><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-EacWF1jH.js" defer></script>
  </body>
</html>
