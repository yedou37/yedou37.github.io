<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.102" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MIT 6.5840 åˆ†å¸ƒå¼ç³»ç»Ÿ","image":[""],"dateModified":"2026-01-28T11:30:46.000Z","author":[{"@type":"Person","name":"yedou","url":"https://yedou37.github.io"}]}</script><meta property="og:url" content="https://yedou37.github.io/courses/6.5840.html"><meta property="og:site_name" content="Yedou's Notebook"><meta property="og:title" content="MIT 6.5840 åˆ†å¸ƒå¼ç³»ç»Ÿ"><meta property="og:description" content="MapReduce è¦æŠŠå¤§è±¡è£…å†°ç®±ï¼ˆå¤„ç† PB çº§æ•°æ®ï¼‰ï¼Œåˆ†ä¸‰æ­¥ï¼š Split (åˆ‡åˆ†): æŠŠå¤§æ–‡ä»¶åˆ‡æˆæ— æ•°ä¸ª 64MB çš„å°å— (Input Splits)ã€‚ Map (æ˜ å°„): æŠŠå°å—è½¬åŒ–æˆ <Key, Value> å¯¹ã€‚ Reduce (å½’çº¦): æŠŠç›¸åŒ Key çš„æ•°æ®èšåœ¨ä¸€èµ·å¤„ç†ã€‚ åœºæ™¯ï¼š ç»Ÿè®¡å•è¯é¢‘ç‡ (Word Count)ã€‚ Map é˜¶æ®µ..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2026-01-28T11:30:46.000Z"><meta property="article:modified_time" content="2026-01-28T11:30:46.000Z"><link rel="icon" href="/logo.jpg"><title>MIT 6.5840 åˆ†å¸ƒå¼ç³»ç»Ÿ | Yedou's Notebook</title><meta name="description" content="MapReduce è¦æŠŠå¤§è±¡è£…å†°ç®±ï¼ˆå¤„ç† PB çº§æ•°æ®ï¼‰ï¼Œåˆ†ä¸‰æ­¥ï¼š Split (åˆ‡åˆ†): æŠŠå¤§æ–‡ä»¶åˆ‡æˆæ— æ•°ä¸ª 64MB çš„å°å— (Input Splits)ã€‚ Map (æ˜ å°„): æŠŠå°å—è½¬åŒ–æˆ <Key, Value> å¯¹ã€‚ Reduce (å½’çº¦): æŠŠç›¸åŒ Key çš„æ•°æ®èšåœ¨ä¸€èµ·å¤„ç†ã€‚ åœºæ™¯ï¼š ç»Ÿè®¡å•è¯é¢‘ç‡ (Word Count)ã€‚ Map é˜¶æ®µ...">
    <link rel="preload" href="/assets/style-CsNPP1bi.css" as="style"><link rel="stylesheet" href="/assets/style-CsNPP1bi.css">
    <link rel="modulepreload" href="/assets/app-f5bTKqOW.js"><link rel="modulepreload" href="/assets/6.5840.html-BrEgvTYe.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container no-navbar external-link-icon has-toc" vp-container><!----><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="æˆ‘çš„ç¬”è®°åº“"><!---->æˆ‘çš„ç¬”è®°åº“<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="fa6-solid:folder-open" sizing="both" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">åŸºç¡€çŸ¥è¯†æ¦‚è§ˆ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="vp-icon" icon="fa6-solid:folder-open" sizing="both" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">è¯¾ç¨‹ç¬”è®°æ¦‚è§ˆ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/courses/6.5840.html" aria-label="MIT 6.5840 åˆ†å¸ƒå¼ç³»ç»Ÿ"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:share-2" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->MIT 6.5840 åˆ†å¸ƒå¼ç³»ç»Ÿ<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="fa6-solid:share-2" sizing="height" height="1em"></iconify-icon>MIT 6.5840 åˆ†å¸ƒå¼ç³»ç»Ÿ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://yedou37.github.io" target="_blank" rel="noopener noreferrer">yedou</a></span><span property="author" content="yedou"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2026/1/28</span><meta property="datePublished" content="2026-01-28T11:28:32.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 20 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT20M"></span><!----><!----></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><hr><h1 id="mapreduce" tabindex="-1"><a class="header-anchor" href="#mapreduce"><span>MapReduce</span></a></h1><p>è¦æŠŠå¤§è±¡è£…å†°ç®±ï¼ˆå¤„ç† PB çº§æ•°æ®ï¼‰ï¼Œåˆ†ä¸‰æ­¥ï¼š</p><ol><li><strong>Split (åˆ‡åˆ†):</strong>Â æŠŠå¤§æ–‡ä»¶åˆ‡æˆæ— æ•°ä¸ª 64MB çš„å°å— (Input Splits)ã€‚</li><li><strong>Map (æ˜ å°„):</strong>Â æŠŠå°å—è½¬åŒ–æˆÂ &lt;Key, Value&gt;Â å¯¹ã€‚</li><li><strong>Reduce (å½’çº¦):</strong>Â æŠŠç›¸åŒ Key çš„æ•°æ®èšåœ¨ä¸€èµ·å¤„ç†ã€‚</li></ol><ul><li><p><strong>åœºæ™¯ï¼š</strong>Â ç»Ÿè®¡å•è¯é¢‘ç‡ (Word Count)ã€‚</p></li><li><p><strong>Map é˜¶æ®µï¼š</strong></p><ul><li>Worker A è¯»æ–‡ä»¶ 1ï¼Œå‘ç° &quot;Apple&quot;ï¼Œè¾“å‡ºÂ &lt;Apple, 1&gt;ã€‚</li><li>Worker B è¯»æ–‡ä»¶ 2ï¼Œå‘ç° &quot;Apple&quot;ï¼Œè¾“å‡ºÂ &lt;Apple, 1&gt;ã€‚</li><li><strong>é—®é¢˜ï¼š</strong>Â è¿™ä¸¤ä¸ªÂ &lt;Apple, 1&gt;Â åˆ†æ•£åœ¨ä¸åŒæœºå™¨ä¸Šï¼ŒReduce æ€ä¹ˆæ±‚å’Œï¼Ÿ</li></ul></li><li><p><strong>Partitioning (åˆ†åŒº):</strong></p><ul><li>ç³»ç»Ÿé¢„å…ˆè§„å®šï¼šhash(&quot;Apple&quot;) % nReduceã€‚å‡è®¾ç»“æœæ˜¯ 0ã€‚</li><li>æ‰€æœ‰ Worker éƒ½çŸ¥é“ï¼šåªè¦é‡åˆ° &quot;Apple&quot;ï¼Œå°±æ‰”è¿›Â <strong>0 å·æ¡¶</strong>ã€‚</li><li>åªè¦é‡åˆ° &quot;Banana&quot;ï¼Œå°±æ‰”è¿›Â <strong>1 å·æ¡¶</strong>ã€‚</li></ul></li><li><p><strong>Shuffle é˜¶æ®µï¼š</strong></p><ul><li>Reduce Worker 0 å¯åŠ¨æ—¶ï¼Œå®ƒä¼šå»<strong>æ‰€æœ‰</strong>Â Map Worker é‚£é‡Œï¼ŒæŠŠÂ <strong>0 å·æ¡¶</strong>Â çš„æ•°æ®å…¨éƒ¨æ‹‰è¿‡æ¥ã€‚</li><li>è¿™æ ·ï¼Œæ‰€æœ‰çš„ &quot;Apple&quot; æœ€ç»ˆéƒ½ä¼šæ±‡èšåˆ° Reduce Worker 0 æ‰‹é‡Œã€‚</li></ul></li><li><p><strong>Coordinator (ä»¥å‰å« Master):</strong></p><ul><li><strong>æ•°é‡ï¼šåªæœ‰ 1 ä¸ªè¿›ç¨‹ã€‚</strong></li><li><strong>èº«ä»½ï¼š</strong>Â æ€»åŒ…å·¥å¤´ã€å¤§ç®¡å®¶ã€‚</li><li><strong>èŒè´£ï¼š</strong>Â å®ƒä¸å¹²ç´¯æ´»ï¼ˆä¸è¯»å†™æ•°æ®ï¼‰ï¼Œåªè´Ÿè´£<strong>åˆ†é…ä»»åŠ¡</strong>ã€<strong>è®°è´¦</strong>ï¼ˆè°åœ¨å¹²ä»€ä¹ˆã€å¹²å®Œæ²¡æœ‰ï¼‰å’Œ<strong>è®¡æ—¶</strong>ï¼ˆè°è¶…æ—¶äº†ï¼‰ã€‚</li></ul></li><li><p><strong>Worker:</strong></p><ul><li><strong>æ•°é‡ï¼šN ä¸ªè¿›ç¨‹ (ç”±ä½ å†³å®š)ã€‚</strong></li><li>åœ¨æµ‹è¯•è„šæœ¬ä¸­ï¼Œé€šå¸¸ä¼šå¯åŠ¨ 3~5 ä¸ª Worker è¿›ç¨‹å¹¶å‘è·‘ã€‚</li><li><strong>èº«ä»½ï¼š</strong>Â é€šç”¨æ‰“å·¥äººã€‚</li><li><strong>èŒè´£ï¼š</strong>Â ä¹Ÿå°±æ˜¯ä½ å†™çš„Â worker.goã€‚å®ƒå¯åŠ¨åä¼šæ˜¯ä¸ªæ­»å¾ªç¯ï¼Œä¸æ–­é—® Coordinatorï¼šâ€œè€æ¿ï¼Œç°åœ¨æœ‰å•¥æ´»ï¼Ÿâ€ <ul><li>å¦‚æœå¤„äº Map é˜¶æ®µï¼ŒCoordinator ä¼šç»™å®ƒæ´¾ Map ä»»åŠ¡ã€‚</li><li>å¦‚æœ Map é˜¶æ®µå…¨ç»“æŸäº†ï¼ŒCoordinator ä¼šç»™å®ƒæ´¾ Reduce ä»»åŠ¡ã€‚</li><li><strong>Worker è‡ªå·±ä¸çŸ¥é“ä¹Ÿä¸å…³å¿ƒç°åœ¨çš„é˜¶æ®µï¼Œå®ƒåªå¬å‘½è¡Œäº‹ã€‚</strong></li></ul></li></ul></li></ul><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>[ åªæœ‰ 1 ä¸ªè¿›ç¨‹ ]</span></span>
<span class="line"><span>      +-----------------+</span></span>
<span class="line"><span>      |   Coordinator   | &lt;---- ä¿å­˜ç€ä»»åŠ¡è¡¨ (Excel)</span></span>
<span class="line"><span>      +-----------------+       1. Mapä»»åŠ¡çŠ¶æ€: [Done, Idle, InProgress...]</span></span>
<span class="line"><span>         ^   ^   ^   |          2. Reduceä»»åŠ¡çŠ¶æ€: [Idle, Idle...]</span></span>
<span class="line"><span>         :   :   :   |</span></span>
<span class="line"><span>(RPCè°ƒç”¨):   :   :   | (RPCå›å¤: &quot;å»åš Mapä»»åŠ¡ #3&quot;)</span></span>
<span class="line"><span>&quot;æ±‚æ´¾æ´»&quot; :   :   :   |</span></span>
<span class="line"><span>         :   :   :   v</span></span>
<span class="line"><span>      +-----------+   +-----------+   +-----------+</span></span>
<span class="line"><span>      | Worker A  |   | Worker B  |   | Worker C  |  &lt;--- N ä¸ªè¿›ç¨‹</span></span>
<span class="line"><span>      +-----------+   +-----------+   +-----------+</span></span>
<span class="line"><span>            |               |               |</span></span>
<span class="line"><span>   (1) è¯»å–è¾“å…¥æ–‡ä»¶     (1) è¯»å–è¾“å…¥    (å¯èƒ½æ˜¯é—²ç½®</span></span>
<span class="line"><span>       pg-xx.txt        pg-yy.txt      æˆ–æ­£åœ¨å¤„ç†)</span></span>
<span class="line"><span>            |               |</span></span>
<span class="line"><span>      [æ‰§è¡Œ MapF]      [æ‰§è¡Œ MapF]</span></span>
<span class="line"><span>            |               |</span></span>
<span class="line"><span>   (2) ç”Ÿæˆä¸­é—´æ–‡ä»¶     (2) ç”Ÿæˆä¸­é—´æ–‡ä»¶</span></span>
<span class="line"><span>       mr-3-0          mr-4-0</span></span>
<span class="line"><span>       mr-3-1          mr-4-1</span></span>
<span class="line"><span>       ...             ...</span></span>
<span class="line"><span>            |               |</span></span>
<span class="line"><span>            +---------------+</span></span>
<span class="line"><span>                    |</span></span>
<span class="line"><span>      -------------------------------------</span></span>
<span class="line"><span>      |    W A I T   (åŒæ­¥å±éšœ)           |  &lt;--- Mapå…¨éƒ¨åšå®Œæ‰èƒ½è¿›ä¸‹ä¸€æ­¥</span></span>
<span class="line"><span>      -------------------------------------</span></span>
<span class="line"><span>                    |</span></span>
<span class="line"><span>      +-----------+   +-----------+</span></span>
<span class="line"><span>      | Worker A  |   | Worker B  |  &lt;--- è¿˜æ˜¯é‚£æ‰¹äººï¼Œç°åœ¨è½¬èŒåš Reduce</span></span>
<span class="line"><span>      +-----------+   +-----------+</span></span>
<span class="line"><span>            |               |</span></span>
<span class="line"><span>   (3) è¯»å–ä¸­é—´æ–‡ä»¶     (3) è¯»å–ä¸­é—´æ–‡ä»¶</span></span>
<span class="line"><span>       æ‰€æœ‰ mr-*-0      æ‰€æœ‰ mr-*-1</span></span>
<span class="line"><span>            |               |</span></span>
<span class="line"><span>      [æ‰§è¡Œ ReduceF]   [æ‰§è¡Œ ReduceF]</span></span>
<span class="line"><span>            |               |</span></span>
<span class="line"><span>   (4) å†™æœ€ç»ˆç»“æœ       (4) å†™æœ€ç»ˆç»“æœ</span></span>
<span class="line"><span>       mr-out-0         mr-out-1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯¹äºworker-æ—¢è¦æ‰§è¡Œmap-reduce-ä»»åŠ¡-ä¹Ÿè¦å‘coordinatorå‘é€å¿ƒè·³åŒ…" tabindex="-1"><a class="header-anchor" href="#å¯¹äºworker-æ—¢è¦æ‰§è¡Œmap-reduce-ä»»åŠ¡-ä¹Ÿè¦å‘coordinatorå‘é€å¿ƒè·³åŒ…"><span>å¯¹äºworker æ—¢è¦æ‰§è¡Œmap reduce ä»»åŠ¡ ä¹Ÿè¦å‘coordinatorå‘é€å¿ƒè·³åŒ…</span></a></h3><h4 id="ä½¿ç”¨ä¸¤ä¸ªgoruntimes" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¸¤ä¸ªgoruntimes"><span>ä½¿ç”¨ä¸¤ä¸ªgoruntimes</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// åˆ›å»ºä¸€ä¸ªchannelç”¨äºé€šçŸ¥å¿ƒè·³goroutineä»»åŠ¡å·²å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	doneChan</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// å¯åŠ¨å¿ƒè·³goroutine</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	go</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			case</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">doneChan</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				// workeré€€å‡º</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				return</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			case</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">After</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">): </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ¯ç§’å‘é€ä¸€æ¬¡å¿ƒè·³</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">				SendHeartbeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å•ç‹¬ä¸€ä¸ªçº¿ç¨‹ å®šæ—¶å‘é€å¿ƒè·³åŒ… å¦‚æœæ”¶åˆ°doneChançš„è¯å°±é€€å‡º è¿™ä¸ªchennelæ˜¯åŸæ¥çš„çº¿ç¨‹ä¸å¿ƒè·³åŒ…çº¿ç¨‹è¿›è¡Œé€šä¿¡çš„é€šé“</p><h3 id="å¹¶è¡Œmap-reduceçš„ç»“æœæ€»æ˜¯å°äºçº¿æ€§-map-reduce" tabindex="-1"><a class="header-anchor" href="#å¹¶è¡Œmap-reduceçš„ç»“æœæ€»æ˜¯å°äºçº¿æ€§-map-reduce"><span>å¹¶è¡Œmap reduceçš„ç»“æœæ€»æ˜¯å°äºçº¿æ€§ map reduce</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yet </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">365</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">---</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yet </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">383</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21617</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">c22072</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yielded </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">9</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">---</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yielded </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">12</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21623</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">a22079</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yoked </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21625</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">c22081</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yonder </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">31</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">---</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yonder </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">33</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21627</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21630</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">c22083</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22086</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> you </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6270</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> young </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">321</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> younger </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">31</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> youngest </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">---</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> you </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7005</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> young </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">365</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> younger </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">36</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> youngest </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">28</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21632</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">c22088</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> your </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1305</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">---</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> your </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1477</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21634</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21637</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">c22090</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22093</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yours </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yourself </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">155</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yourselves </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">11</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> youth </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">61</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">---</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yours </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">34</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yourself </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">172</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> yourselves </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">14</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> youth </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">105</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21650</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">c22106</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è™½ç„¶æˆ‘æœ€åˆåœ¨æ‰€æœ‰coordinatorçš„æ–¹æ³•ä¸Šéƒ½åŠ äº†å¤§é” ä½†æ˜¯è¿˜æ˜¯å‡ºç°äº†æ•°æ®ä¸¢å¤±çš„é—®é¢˜ å¯ä»¥çœ‹å‡ºï¼šç»“æœæ•°æ®å‡å°äºåº”æœ‰çš„æ•°å­—</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			// worker is not busy ask for a task</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">			RequestTask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">worker)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			if</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">has_work_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">				time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				continue</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			if</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">is_reduce_task_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">										// map task</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				file, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_file_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> err </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nil {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">					log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Fatalf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cannot open %v&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_file_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				content, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ioutil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ReadAll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(file)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> err </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nil {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">					log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Fatalf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cannot read %v&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_file_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">				file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				//fmt.Println(string(content[0:20]))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">				kva</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> mapf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_file_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(content))</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">				TaskDone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">worker)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">can_write_files_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">					// abort all tasks</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">					//log.Println(&quot;abort&quot;)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">					continue</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				// write to files</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				//log.Println(&quot;mid write to files&quot;)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">				ofiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> []*os.File{}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				for</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nReduce_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">					file_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;mr-mid-&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> strconv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Itoa</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_id_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;-&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> strconv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Itoa</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(i)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">					ofile, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> os</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(file_name)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">					ofiles </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> append</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ofiles, ofile)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> _, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> range kva { </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">					fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Fprintf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ofiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ihash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">%</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nReduce_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)], </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;%v %v</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				} 	</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> _, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ofile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> range ofiles {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">					ofile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›®å‰ä¸ºäº†å®ç°aborté€»è¾‘ æˆ‘é€‰æ‹©äº† å…ˆå®Œæˆmapæˆ–è€…reduceä»»åŠ¡ ç„¶åé€šçŸ¥coordinator å¦‚æœcoordinatorè®¤å®šäº†è¿™ä¸ªworkerå°±æ˜¯åº”è¯¥å®Œæˆæ“ä½œçš„workerï¼ˆä¸æ˜¯ä¹‹å‰è¢«æ”¾å¼ƒçš„â€”â€”ä»»åŠ¡å·²ç»åˆ†é…ç»™åˆ«äººäº†ï¼‰é‚£ä¹ˆå°±èƒ½å†™æ–‡ä»¶ ä½†æ˜¯è¿™é‡Œå‡ºç°äº†é™æ€æ¡ä»¶ å¯¹äºcoordinator ä»–è®¤ä¸ºä»»åŠ¡å®Œæˆäº† ä½†æ˜¯å…¶å®æ–‡ä»¶è¿˜æ²¡æœ‰çœŸæ­£è¢«å†™å®Œ å¦‚æœè¿™ä¸ªæ—¶å€™è¿›å…¥reduce é‚£ä¹ˆå°±ä¼šè¯»å–è¿˜æ²¡æœ‰å®Œå…¨å†™å®Œçš„è„æ•°æ® å¯¼è‡´æœ€åç»Ÿè®¡ç»“æœåå°</p><p><strong>Worker å‘Šè¯‰ Coordinator &quot;æˆ‘åšå®Œäº†&quot; å’Œ Worker &quot;å®é™…æŠŠæ•°æ®è½ç›˜&quot; ä¹‹é—´çš„æ—¶é—´å·®</strong> å¯¼è‡´äº†<strong>æ—¶åºé”™ä¹±</strong></p><h4 id="è§£å†³æ–¹æ³•-ä½¿ç”¨åŸå­æ–‡ä»¶é‡å‘½å" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ³•-ä½¿ç”¨åŸå­æ–‡ä»¶é‡å‘½å"><span>è§£å†³æ–¹æ³• ä½¿ç”¨åŸå­æ–‡ä»¶é‡å‘½å</span></a></h4><p>os.Rename(&quot;tmp-mr-out-1&quot;, &quot;mr-out-1&quot;)Â (è¿™æ˜¯ä¸€ä¸ªåŸå­ç¬é—´åŠ¨ä½œ)<br><strong>åªè¦ Coordinator è®¤ä¸ºä»»åŠ¡å®Œæˆäº†ï¼Œç£ç›˜ä¸Šçš„æ–‡ä»¶å°±ä¸€å®šæ˜¯å®Œæ•´çš„</strong></p><h3 id="å¦‚æœè¿™ä¸ªworker-çªç„¶å´©æºƒäº†" tabindex="-1"><a class="header-anchor" href="#å¦‚æœè¿™ä¸ªworker-çªç„¶å´©æºƒäº†"><span>å¦‚æœè¿™ä¸ªworker çªç„¶å´©æºƒäº†</span></a></h3><p>å‡å¦‚ä¸€ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çªç„¶æ–­ç”µ å¦‚æœåŸæ¥æ˜¯ç›´æ¥å†™åœ¨ç»“æœæ–‡ä»¶ä¸­çš„ é‚£ä¹ˆä¼šç•™ä¸‹ä¸€ä¸ªæŸåçš„æ–‡ä»¶</p><h4 id="è§£å†³æ–¹æ³•-è¿˜æ˜¯åŸå­æ–‡ä»¶é‡å‘½å" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ³•-è¿˜æ˜¯åŸå­æ–‡ä»¶é‡å‘½å"><span>è§£å†³æ–¹æ³• è¿˜æ˜¯åŸå­æ–‡ä»¶é‡å‘½å</span></a></h4><ol><li><strong>å´©æºƒå‘ç”Ÿåœ¨å†™ä¸´æ—¶æ–‡ä»¶æ—¶</strong>ï¼š <ul><li>å¦‚æœ Worker åœ¨å†™å…¥Â mr-mid-tmp-xxxÂ çš„è¿‡ç¨‹ä¸­æŒ‚æ‰äº†ï¼ˆæ–­ç”µã€ç½‘ç»œæ–­å¼€ã€è¿›ç¨‹å´©æºƒï¼‰ã€‚</li><li>ç£ç›˜ä¸Šåªä¼šç•™ä¸‹ä¸€ä¸ªå†™äº†ä¸€åŠçš„<strong>åƒåœ¾æ–‡ä»¶</strong>ï¼ˆGarbage/Partial Fileï¼‰ã€‚</li><li>ä½†æ˜¯ï¼Œæœ€ç»ˆçš„æ–‡ä»¶åÂ mr-mid-X-YÂ <strong>æ ¹æœ¬å°±æ²¡æœ‰è¢«åˆ›å»º</strong>ï¼ˆæˆ–è€…å¦‚æœä¹‹å‰æœ‰æ—§çš„ï¼Œä¹Ÿæ²¡è¢«ç¢°è¿‡ï¼‰ã€‚</li><li>Coordinator å‘ç°è¿™ä¸ª Worker è¶…æ—¶ï¼ˆä¸å†å‘é€å¿ƒè·³ï¼‰ï¼Œå°±ä¼šæŠŠä»»åŠ¡é‡æ–°åˆ†é…ç»™å¦ä¸€ä¸ª Workerã€‚</li><li>æ–°çš„ Worker ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ª<strong>æ–°çš„</strong>ä¸´æ—¶æ–‡ä»¶å¼€å§‹å†™ã€‚</li><li><strong>ç»“è®º</strong>ï¼šç³»ç»ŸçŠ¶æ€æ˜¯å¹²å‡€çš„ï¼Œæ²¡æœ‰è„æ•°æ®æ±¡æŸ“æœ€ç»ˆç»“æœã€‚</li></ul></li><li><strong>å´©æºƒå‘ç”Ÿåœ¨é‡å‘½åé‚£ä¸€ç¬é—´</strong>ï¼š <ul><li>åœ¨æ“ä½œç³»ç»Ÿï¼ˆå°¤å…¶æ˜¯ POSIX æ ‡å‡†çš„æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸­ï¼ŒRenameÂ æ˜¯<strong>åŸå­</strong>çš„ã€‚</li><li>è¿™æ„å‘³ç€ï¼šè¦ä¹ˆæ”¹åæˆåŠŸï¼Œæ–‡ä»¶ç¬é—´å˜æˆæœ€ç»ˆæ–‡ä»¶ï¼›è¦ä¹ˆå®Œå…¨æ²¡å‘ç”Ÿï¼Œæ–‡ä»¶è¿˜æ˜¯ä¸´æ—¶æ–‡ä»¶åã€‚</li><li><strong>ç»å¯¹ä¸ä¼šå‡ºç°</strong>â€œæ”¹åæ”¹äº†ä¸€åŠâ€æˆ–è€…â€œæ–‡ä»¶æŸåâ€çš„æƒ…å†µã€‚</li><li>è¿™å°±åƒä¸€ä¸ª<strong>å¼€å…³</strong>ï¼Œåªæœ‰ 0 å’Œ 1ï¼Œæ²¡æœ‰ä¸­é—´çŠ¶æ€ã€‚</li></ul></li></ol><h3 id="è¿™å°±æ˜¯æ‰€è°“çš„-commit-point-æäº¤ç‚¹" tabindex="-1"><a class="header-anchor" href="#è¿™å°±æ˜¯æ‰€è°“çš„-commit-point-æäº¤ç‚¹"><span>è¿™å°±æ˜¯æ‰€è°“çš„â€œCommit Pointâ€ï¼ˆæäº¤ç‚¹ï¼‰</span></a></h3><p>åœ¨ MapReduce Worker ä»£ç ä¸­ï¼Œos.RenameÂ å°±ç›¸å½“äºæ•°æ®åº“äº‹åŠ¡ä¸­çš„Â <strong>COMMIT</strong>Â å‘½ä»¤ï¼š</p><ul><li><strong>Rename ä¹‹å‰</strong>ï¼šæ‰€æœ‰çš„è®¡ç®—å’Œ IO éƒ½æ˜¯â€œè‰ç¨¿â€ï¼Œéšæ—¶å¯ä»¥æ‰”æ‰ï¼Œå¯¹å¤–ç•Œï¼ˆCoordinator å’Œ Reducerï¼‰ä¸å¯è§ã€‚</li><li><strong>Rename ä¹‹å</strong>ï¼šæ•°æ®ç¬é—´ç”Ÿæ•ˆï¼Œå¯¹å¤–ç•Œå¯è§ã€‚</li></ul><h4 id="å¦‚æœworker1è¢«æŠ›å¼ƒäº†-æ–°æŒ‡æ´¾çš„worker2å®Œæˆäº†å·¥ä½œ-è¿™æ—¶worker1åˆå®Œæˆäº†æ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#å¦‚æœworker1è¢«æŠ›å¼ƒäº†-æ–°æŒ‡æ´¾çš„worker2å®Œæˆäº†å·¥ä½œ-è¿™æ—¶worker1åˆå®Œæˆäº†æ€ä¹ˆåŠ"><span>å¦‚æœworker1è¢«æŠ›å¼ƒäº† æ–°æŒ‡æ´¾çš„worker2å®Œæˆäº†å·¥ä½œ è¿™æ—¶worker1åˆå®Œæˆäº†æ€ä¹ˆåŠ</span></a></h4><p>paperä¸­å†™é“</p><blockquote><p>We rely on atomic commits of map and reduce task outputs to achieve this property. Each in-progress task writes its output to private temporary files. A reduce task produces one such file, and a map task produces R such files (one per reduce task). When a map task completes, the worker sends a message to the master and includes the names of the R temporary files in the message. If the master receives a completion message for an already completed map task, it <strong>ignores</strong> the message. Otherwise, it records the names of R files in a master data structure. When a reduce task completes, the reduce worker atomically renames its temporary output file to the final output file. If the same reduce task is executed on multiple machines, <strong>multiple rename calls will be executed for the same final output file. We rely on the atomic rename operation provided by the underlying file system</strong> to guarantee that the final file system state contains just the data produced by one execution of the reduce task.</p></blockquote><p>å¯¹äºmap ç³»ç»Ÿè®°å½•ä¸‹ç¬¬ä¸€ä¸ªå‘å‡ºdoneçš„workeråˆ›å»ºçš„é‚£äº›æ–‡ä»¶ å¿½ç•¥åé¢çš„<br> å¯¹äºreduceæ¯æ¬¡éƒ½ä¼šå…ˆåˆ›å»ºä¸´æ—¶æ–‡ä»¶ ç„¶åè¿›è¡ŒåŸå­é‡å‘½å æ“ä½œç³»ç»Ÿä¿è¯äº†æœ€åçš„ç»“æœæ˜¯ä¸€æ¬¡æ“ä½œçš„è¾“å‡º</p><h3 id="coordinatorçš„å¹‚ç­‰æ€§-å’Œ-map-reduceæ–¹æ³•çš„ç¡®å®šæ€§" tabindex="-1"><a class="header-anchor" href="#coordinatorçš„å¹‚ç­‰æ€§-å’Œ-map-reduceæ–¹æ³•çš„ç¡®å®šæ€§"><span>coordinatorçš„å¹‚ç­‰æ€§ å’Œ map reduceæ–¹æ³•çš„ç¡®å®šæ€§</span></a></h3><p>Coordinator æ£€æŸ¥ Task X çš„çŠ¶æ€ã€‚å‘ç°å·²ç»æ˜¯Â CompletedÂ äº†ï¼Œäºæ˜¯<strong>ä»€ä¹ˆéƒ½ä¸åš</strong>ï¼ˆæˆ–è€…ä»…è¿”å›ä¸€ä¸ªç¡®è®¤ï¼Œä½†ä¸ä¿®æ”¹å†…éƒ¨çŠ¶æ€ï¼‰ã€‚</p><ul><li><p>å…¬å¼è¡¨è¾¾ï¼š<code>HandleDone(Task X) = HandleDone(HandleDone(Task X))</code><br> å¯¹äº map å’Œ reduce æ–¹æ³•æ¥è¯´ ä¸åŒ…å«éšæœºæ•° æ¯æ¬¡æ‰§è¡Œçš„ç»“æœä¸€å®šæ˜¯ä¸€æ ·çš„</p></li><li><p>æ‰€ä»¥å°±å¯ä»¥æŠŠä¸€ä¸ªä»»åŠ¡åˆ†é…ç»™å¤šä¸ªworkeræ‰§è¡Œ ä¸ä¼šå½±å“æœ€åç»“æœ</p></li></ul><blockquote><p>Google çš„å®ç°æŒ‡å‡ºï¼Œå¦‚æœä½ çš„å‡½æ•°æ˜¯ä¸ç¡®å®šçš„ï¼ˆæ¯”å¦‚åŒ…å«éšæœºæ•°ï¼‰ï¼ŒMapReduce æ¡†æ¶åªèƒ½ä¿è¯è¾“å‡ºç»“æœæ˜¯â€œæŸä¸€æ¬¡â€æ‰§è¡Œçš„ç»“æœï¼Œä½†æ— æ³•ä¿è¯å¤šæ¬¡è¿è¡Œç»“æœä¸€è‡´ï¼ˆå¼±ä¸€è‡´æ€§ï¼‰ã€‚ä½†åœ¨æ ‡å‡†ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éƒ½å‡è®¾å‡½æ•°æ˜¯ç¡®å®šæ€§çš„ï¼Œè¿™æ ·å°±å¯ä»¥æ”¾å¿ƒåœ°è®© Straggler å’Œ Backup Worker äº’ç›¸è¦†ç›–æ–‡ä»¶ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ•°æ®é”™ä¹±</p></blockquote><h1 id="raft" tabindex="-1"><a class="header-anchor" href="#raft"><span>RAFT</span></a></h1><h2 id="å¦‚ä½•ä¿æŒå¼ºä¸€è‡´æ€§â€”â€”prevlogidx-prevlogterm" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿æŒå¼ºä¸€è‡´æ€§â€”â€”prevlogidx-prevlogterm"><span>å¦‚ä½•ä¿æŒå¼ºä¸€è‡´æ€§â€”â€”PrevLogIdx PrevLogTerm</span></a></h2><p>å¯ä»¥æŠŠ <code>PrevLogIndex</code> å’Œ <code>PrevLogTerm</code> æƒ³è±¡æˆ<strong>æ‹¼å›¾çš„æ¥å£</strong>æˆ–è€…<strong>æ‹‰é“¾çš„é”æ‰£</strong>ã€‚</p><h3 id="é€šä¿—è§£é‡Š-æ‹‰é“¾åŸç†" tabindex="-1"><a class="header-anchor" href="#é€šä¿—è§£é‡Š-æ‹‰é“¾åŸç†"><span>é€šä¿—è§£é‡Šï¼šæ‹‰é“¾åŸç†</span></a></h3><p>å‡è®¾ Leader è¦ç»™ Follower å‘é€ç¬¬ 100 å·æ—¥å¿—ã€‚Leader ä¸èƒ½ç›´æ¥æ‰”è¿‡å»è¯´ï¼šâ€œè¿™æ˜¯ç¬¬ 100 å·ï¼Œä½ å­˜ä¸‹â€ã€‚<br> å› ä¸º Follower å¯èƒ½æ¯”è¾ƒå¡ï¼Œå®ƒçš„æ—¥å¿—æ‰å­˜åˆ°ç¬¬ 80 å·ã€‚å¦‚æœå®ƒç›´æ¥å­˜ä¸‹ç¬¬ 100 å·ï¼Œä¸­é—´å°±ç¼ºäº† 19 æ¡ï¼Œè¿™å°±å®Œè›‹äº†ã€‚</p><p>æ‰€ä»¥ï¼ŒLeader åœ¨å‘ç¬¬ 100 å·æ—¥å¿—æ—¶ï¼Œå¿…é¡»å¸¦ä¸Šç¬¬ 99 å·çš„ä¿¡æ¯ä½œä¸ºâ€œéªŒè¯ç â€ï¼š</p><ul><li><strong>PrevLogIndex (å‰ä¸€æ¡æ—¥å¿—çš„ç´¢å¼•)</strong>: 99</li><li><strong>PrevLogTerm (å‰ä¸€æ¡æ—¥å¿—çš„ä»»æœŸ)</strong>: æ¯”å¦‚ Term 5</li></ul><p>Leader å¯¹ Follower è¯´ï¼šâ€œæˆ‘è¦ç»™ä½ å‘ç¬¬ 100 å·æ—¥å¿—ã€‚ä½†åœ¨æ¥æ”¶ä¹‹å‰ï¼Œè¯·ä½ æ£€æŸ¥ä¸€ä¸‹ä½ é‚£é‡Œæœ‰æ²¡æœ‰ç¬¬ 99 å·æ—¥å¿—ï¼Œä¸”å®ƒçš„ä»»æœŸæ˜¯ä¸æ˜¯ Term 5ï¼Ÿâ€</p><ul><li><strong>æƒ…å†µ A (åŒ¹é…)</strong>ï¼šFollower çœ‹äº†ä¸€çœ¼ï¼Œè‡ªå·±ç¡®å®æœ‰ç¬¬ 99 å·ï¼Œä¹Ÿæ˜¯ Term 5ã€‚äºæ˜¯å›å¤ï¼šâ€œåŒ¹é…æˆåŠŸï¼Œæˆ‘æ”¶ä¸‹ç¬¬ 100 å·ã€‚â€ï¼ˆæ‹‰é“¾æ‹‰ä¸Šäº†ï¼‰ã€‚</li><li><strong>æƒ…å†µ B (ç¼ºå¤±)</strong>ï¼šFollower å‘ç°è‡ªå·±åªæœ‰ç¬¬ 80 å·ã€‚å®ƒå›å¤ï¼šâ€œæ‹’ç»ï¼Œæˆ‘æ²¡æœ‰ç¬¬ 99 å·ã€‚â€ Leader æ”¶åˆ°æ‹’ç»åï¼Œä¸‹æ¬¡å°±ä¼šè¯•ç€å‘ç¬¬ 81 å·ï¼ˆå¸¦ä¸Šç¬¬ 80 å·åšéªŒè¯ï¼‰ã€‚</li><li><strong>æƒ…å†µ C (å†²çª)</strong>ï¼šFollower æœ‰ç¬¬ 99 å·ï¼Œä½†æ˜¯æ˜¯ Term 4ï¼ˆæ—§ Leader ç•™ä¸‹çš„åƒåœ¾æ•°æ®ï¼‰ã€‚å®ƒå›å¤ï¼šâ€œæ‹’ç»ï¼Œæˆ‘æœ‰ç¬¬ 99 å·ï¼Œä½†Termä¸å¯¹ã€‚â€ Leader æ”¶åˆ°åï¼ŒçŸ¥é“è¿™é‡Œæ•°æ®ä¸ä¸€è‡´ï¼Œä¸‹æ¬¡ä¼šå¼ºè¡Œè¦†ç›–å®ƒã€‚</li></ul><hr><h3 id="å›¾è§£" tabindex="-1"><a class="header-anchor" href="#å›¾è§£"><span>å›¾è§£</span></a></h3><p>å‡è®¾ç°åœ¨çš„çŠ¶æ€å¦‚ä¸‹ï¼š</p><p><strong>Leader çš„æ—¥å¿—ï¼š</strong></p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>Index: 1  2  3  4  5</span></span>
<span class="line"><span>Term:  1  1  2  3  3</span></span>
<span class="line"><span>       ^  ^  ^  ^  ^</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Leader æƒ³è¦å‘é€ Index=4 å’Œ Index=5 çš„æ—¥å¿—ç»™ Followerã€‚<br> æ­¤æ—¶ï¼Œ<code>AppendEntries</code> RPC å‚æ•°ä¼šæ˜¯ï¼š</p><ul><li><strong>Entries</strong>: <code>[Log(Index:4, Term:3), Log(Index:5, Term:3)]</code></li><li><strong>PrevLogIndex</strong>: 3 (æ–°æ—¥å¿—çš„å‰ä¸€æ¡)</li><li><strong>PrevLogTerm</strong>: 2 (Index 3 å¤„çš„ä»»æœŸ)</li></ul><p><strong>åœºæ™¯ 1ï¼šFollower æ˜¯å¥åº·çš„</strong></p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>Follower A æ—¥å¿—:</span></span>
<span class="line"><span>Index: 1  2  3</span></span>
<span class="line"><span>Term:  1  1  2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Follower A æ”¶åˆ° RPCï¼š</p><ol><li>çœ‹ <code>PrevLogIndex</code> (3)ã€‚æˆ‘æœ‰ Index 3 å—ï¼Ÿæœ‰ã€‚</li><li>çœ‹ <code>PrevLogTerm</code> (2)ã€‚æˆ‘ Index 3 çš„ Term æ˜¯ 2 å—ï¼Ÿæ˜¯ã€‚</li><li><strong>æˆåŠŸ</strong>ã€‚æŠŠæ–°çš„æ—¥å¿— 4 å’Œ 5 æ¥åœ¨åé¢ã€‚</li></ol><p><strong>åœºæ™¯ 2ï¼šFollower è½åäº† (ç¼ºå¤±)</strong></p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>Follower B æ—¥å¿—:</span></span>
<span class="line"><span>Index: 1  2</span></span>
<span class="line"><span>Term:  1  1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Follower B æ”¶åˆ° RPCï¼š</p><ol><li>çœ‹ <code>PrevLogIndex</code> (3)ã€‚æˆ‘æœ‰ Index 3 å—ï¼Ÿ<strong>æ²¡æœ‰ï¼</strong></li><li><strong>å¤±è´¥</strong>ã€‚è¿”å› <code>Success = false</code>ã€‚</li><li>Leader æ”¶åˆ°å¤±è´¥ï¼Œä¼šå°† <code>nextIndex</code> å‡å°ï¼Œä¸‹æ¬¡æ”¹ä¸ºå‘é€ Index 3ï¼ˆå¸¦ä¸Š PrevLogIndex: 2ï¼‰ã€‚</li></ol><p><strong>åœºæ™¯ 3ï¼šFollower æ­¤æ—¶æœ‰è„æ•°æ® (å†²çª)</strong></p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>Follower C æ—¥å¿—:</span></span>
<span class="line"><span>Index: 1  2  3</span></span>
<span class="line"><span>Term:  1  1  1  &lt;-- æ³¨æ„è¿™é‡Œæ˜¯ 1ï¼ŒLeader æœŸæœ›æ˜¯ 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Follower C æ”¶åˆ° RPCï¼š</p><ol><li>çœ‹ <code>PrevLogIndex</code> (3)ã€‚æˆ‘æœ‰ Index 3 å—ï¼Ÿæœ‰ã€‚</li><li>çœ‹ <code>PrevLogTerm</code> (2)ã€‚æˆ‘ Index 3 çš„ Term æ˜¯ 2 å—ï¼Ÿ<strong>ä¸æ˜¯ï¼Œæˆ‘æ˜¯ 1ã€‚</strong></li><li><strong>å¤±è´¥</strong>ã€‚è¿”å› <code>Success = false</code>ã€‚</li><li>è¿™è¡¨ç¤º Follower çš„ Index 3 æ˜¯é”™çš„ï¼ŒLeader ä¹‹åä¼šä¸€æ­¥æ­¥å›é€€ï¼Œæœ€ç»ˆæŠŠè¿™ä¸ª Term 1 çš„é”™è¯¯æ—¥å¿—è¦†ç›–æ‰ã€‚</li></ol><hr><h3 id="ä»£ç å®ç°é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#ä»£ç å®ç°é€»è¾‘"><span>ä»£ç å®ç°é€»è¾‘</span></a></h3><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-index-0-dummy-entry" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-index-0-dummy-entry"><span>ä¸ºä»€ä¹ˆéœ€è¦ Index 0 (Dummy Entry)ï¼Ÿ</span></a></h4><p>ä¸ºäº†æ–¹ä¾¿å¤„ç† <code>PrevLogIndex</code>ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨ <code>rf.log</code> åˆå§‹åŒ–æ—¶æ”¾ä¸€ä¸ªç©ºçš„æ—¥å¿—å ä½ã€‚<br><code>rf.log[0] = LogEntry{Term: 0}</code><br> è¿™æ ·ï¼Œå¦‚æœ Leader è¦å‘ç¬¬ä¸€æ¡çœŸçš„æ—¥å¿—ï¼ˆIndex 1ï¼‰ï¼Œå®ƒçš„ <code>PrevLogIndex</code> å°±æ˜¯ 0ï¼Œ<code>PrevLogTerm</code> å°±æ˜¯ 0ã€‚ä½ å°±ä¸ç”¨å†™ä¸€å † <code>if index == 0</code> çš„ç‰¹æ®Šåˆ¤æ–­é€»è¾‘äº†ã€‚</p><h4 id="leader-ç«¯æ€ä¹ˆè®¡ç®—-å‘é€æ–¹" tabindex="-1"><a class="header-anchor" href="#leader-ç«¯æ€ä¹ˆè®¡ç®—-å‘é€æ–¹"><span>Leader ç«¯æ€ä¹ˆè®¡ç®—ï¼Ÿ (å‘é€æ–¹)</span></a></h4><p>Leader ç»´æŠ¤äº† <code>nextIndex[]</code>ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªè¦å‘ç»™æŸä¸ª Peer çš„æ—¥å¿—ç´¢å¼•ã€‚</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å‡è®¾è¦å‘ç»™ server p</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nextIdx</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nextIndex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// PrevLogIndex å°±æ˜¯æˆ‘ä»¬è¦å‘çš„è¿™ä¸€æ‰¹çš„å‰ä¸€ä¸ª</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">prevLogIndex</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> nextIdx</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">prevLogTerm</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">prevLogIndex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Term</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¦å‘çš„æ—¥å¿—åˆ‡ç‰‡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">entries</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nextIdx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AppendEntriesArgs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    PrevLogIndex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">prevLogIndex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    PrevLogTerm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:  </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">prevLogTerm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Entries</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:      </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">entries</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ... å…¶ä»–å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="follower-ç«¯æ€ä¹ˆæ£€æŸ¥-æ¥æ”¶æ–¹" tabindex="-1"><a class="header-anchor" href="#follower-ç«¯æ€ä¹ˆæ£€æŸ¥-æ¥æ”¶æ–¹"><span>Follower ç«¯æ€ä¹ˆæ£€æŸ¥ï¼Ÿ (æ¥æ”¶æ–¹)</span></a></h4><p>è¿™æ˜¯ <code>AppendEntries</code> ä¸­æœ€å…³é”®çš„é€»è¾‘ï¼š</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">rf </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Raft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AppendEntries</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">AppendEntriesArgs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">reply</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">AppendEntriesReply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 1. Term æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Term</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">currentTerm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 2. ä¸€è‡´æ€§æ£€æŸ¥ (Consistency Check)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æƒ…å†µ A: æˆ‘è¿è¿™ä¸ªä½ç½®çš„æ—¥å¿—éƒ½æ²¡æœ‰ (æ—¥å¿—å¤ªçŸ­)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PrevLogIndex</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> len</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        reply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Success</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        reply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Term</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">currentTerm</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æƒ…å†µ B: æˆ‘æœ‰è¿™ä¸ªä½ç½®çš„æ—¥å¿—ï¼Œä½†æ˜¯ Term ä¸åŒ¹é…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PrevLogIndex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Term</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PrevLogTerm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        reply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Success</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        reply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Term</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">currentTerm</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ä¼˜åŒ–ï¼š3C ä¼šåœ¨è¿™é‡Œåšå†²çªä¼˜åŒ–</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 3. åˆ°äº†è¿™é‡Œï¼Œè¯´æ˜å‰é¢éƒ½åŒ¹é…ä¸Šäº†ï¼</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å³ä½¿ entries æ˜¯ç©ºçš„ï¼ˆå¿ƒè·³ï¼‰ï¼Œä¹Ÿè¯´æ˜è‡³å°‘åˆ° PrevLogIndex ä½ç½®æ˜¯ä¸€è‡´çš„ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 4. å¤„ç†æ—¥å¿—è¿½åŠ å’Œå†²çªè¦†ç›– (Log Truncation and Append)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // éå† args.Entriesï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸åŒ¹é…çš„ä½ç½®ï¼Œåˆ é™¤å®ƒåŠä¹‹åçš„æ‰€æœ‰ï¼Œç„¶åæŠŠæ–°çš„æ¥ä¸Šå»ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ... (åç»­å®ç°)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    reply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Success</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>PrevLogIndex</strong>: è¿™æ¬¡è¦ä¼ çš„æ–°è´§ä¹‹å‰ï¼Œæœ€åé‚£æ¡æ—§è´§çš„ç¼–å·ã€‚</li><li><strong>PrevLogTerm</strong>: é‚£æ¡æ—§è´§çš„ç”Ÿäº§æ‰¹æ¬¡ã€‚</li><li><strong>ä½œç”¨</strong>: åªæœ‰æ—§è´§å¯¹ä¸Šäº†ï¼Œæ‰å…è®¸æ¥æ–°è´§ã€‚è¿™æ˜¯ Raft ä¿è¯æ‰€æœ‰èŠ‚ç‚¹æ—¥å¿—æœ€ç»ˆä¸€æ¨¡ä¸€æ ·çš„æ ¹æœ¬åŸå› ï¼ˆæ•°å­¦å½’çº³æ³•ï¼‰ã€‚</li></ul><h2 id="æŒä¹…åŒ–ä¸æäº¤" tabindex="-1"><a class="header-anchor" href="#æŒä¹…åŒ–ä¸æäº¤"><span>æŒä¹…åŒ–ä¸æäº¤</span></a></h2><p>æŒä¹…åŒ–æ˜¯ä¸€ä¸ªèŠ‚ç‚¹è‡ªå·±çš„è¡Œä¸º ä½œç”¨æ˜¯å°† Â <code>currentTerm</code>ã€<code>voteFor</code>Â å’ŒÂ <code>log[]</code> å­˜å‚¨åˆ°ç£ç›˜ä¸­ é˜²æ­¢æ–­ç”µ æˆ–è€…ç”¨äºæ–­ç”µåçš„æ¢å¤</p><p>æäº¤åˆ™æ˜¯è¾¾æˆå…±è¯†ä»¥å äº¤ç»™ä¸Šå±‚çš„kv serverè¿›è¡Œæ‰§è¡Œ æäº¤çš„ä¿¡æ¯æ˜¯ä¸èƒ½æ”¹å˜çš„ ä½†æ˜¯æŒä¹…åŒ–çš„ä¿¡æ¯å¯èƒ½è¢«æ–°çš„leaderè¦†ç›–æ‰</p><p><strong>ä¸€å®šè¦å…ˆæŒä¹…åŒ–å†å›å¤RPC</strong><br><strong>æäº¤çš„å‰ææ˜¯åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹å®Œæˆäº†æŒä¹…åŒ– è€Œä¸æ˜¯å®Œæˆäº†æ—¥å¿—çš„ä¸€è‡´</strong></p><h1 id="raft-kv-åœ¨ç°å®ç”Ÿæ´»ä¸­æ˜¯æ€ä¹ˆè¢«ä½¿ç”¨çš„" tabindex="-1"><a class="header-anchor" href="#raft-kv-åœ¨ç°å®ç”Ÿæ´»ä¸­æ˜¯æ€ä¹ˆè¢«ä½¿ç”¨çš„"><span>RAFT KV åœ¨ç°å®ç”Ÿæ´»ä¸­æ˜¯æ€ä¹ˆè¢«ä½¿ç”¨çš„</span></a></h1><p>å‡è®¾æˆ‘æœ‰äº”å°æœºå™¨ ä¸‹é¢ç®¡ç†äº†ä¸Šåƒä¸ªGPUæœºå™¨ ç”¨æ¥è®­ç»ƒæ¨¡å‹</p><p>KV RAFTå…¶å®åªå¯¹å¤–æä¾›ä¸¤ä¸ªæ¥å£ ä¸€ä¸ªæ˜¯PUT ä¸€ä¸ªæ˜¯GET ä½†æ˜¯ä»–èƒ½ä¿è¯</p><ul><li>çº¿æ€§ä¸€è‡´æ€§ï¼šåªè¦æœ‰ä¸€ä¸ªPUTæˆåŠŸäº† å‰©ä¸‹ä»»ä½•äºº åœ¨ä»»ä½•åœ°æ–¹ è°ƒç”¨GET ä¸€å®šèƒ½å¤Ÿå¾—åˆ°è¿™ä¸ªä¸€æ ·çš„å€¼</li><li>é«˜å¯ç”¨æ€§ï¼šè¿™äº”ä¸ªç®¡ç†è€…å¦‚æœæœ‰ä¸‰ä¸ªå¯ç”¨ å°±èƒ½å¤Ÿæ­£å¸¸è¿›è¡ŒæœåŠ¡</li><li>æŒä¹…æ€§ä¸å”¯ä¸€æ€§</li></ul><h3 id="ä¸€ã€-è¿™-5-å°æœºå™¨-kv-raft-åœ¨åœ°ç†ä¸Šåˆ†å¸ƒåœ¨å“ªé‡Œ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€-è¿™-5-å°æœºå™¨-kv-raft-åœ¨åœ°ç†ä¸Šåˆ†å¸ƒåœ¨å“ªé‡Œ"><span>ä¸€ã€ è¿™ 5 å°æœºå™¨ï¼ˆKV-Raftï¼‰åœ¨åœ°ç†ä¸Šåˆ†å¸ƒåœ¨å“ªé‡Œï¼Ÿ</span></a></h3><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œè¿™ 5 å°æœºå™¨çš„ç‰©ç†ä½ç½®å–å†³äºä½ å¯¹ <strong>â€œå®¹ç¾â€</strong> çš„è¦æ±‚ã€‚</p><ol><li><p><strong>åŒæœºæˆ¿åˆ†å¸ƒï¼ˆLANï¼‰</strong>ï¼š</p><ul><li>æ”¾åœ¨ä¸€ä¸ªæœºæˆ¿çš„ 5 ä¸ªä¸åŒæœºæ¶ä¸Šã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šé€Ÿåº¦æå¿«ï¼Œå»¶è¿Ÿ &lt; 1msã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœæ•´ä¸ªæœºæˆ¿ç€ç«æˆ–æ–­ç”µï¼Œç³»ç»Ÿå°±å½»åº•æŒ‚äº†ã€‚</li></ul></li><li><p><strong>è·¨å¯ç”¨åŒºåˆ†å¸ƒï¼ˆMulti-AZï¼‰</strong>ï¼š</p><ul><li>åœ¨åŒä¸€ä¸ªåŸå¸‚ï¼ˆæ¯”å¦‚åŒ—äº¬ï¼‰ï¼Œåˆ†å¸ƒåœ¨ 3 ä¸ªä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼ˆæœºæˆ¿ Aã€Bã€Cï¼‰ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½æŠµå¾¡å•ä¸ªæœºæˆ¿çº§åˆ«çš„æ•…éšœã€‚</li><li><strong>è¿™ç§æœ€å¸¸è§</strong>ï¼ˆæ¯”å¦‚ AWS æˆ–é˜¿é‡Œäº‘çš„å…¸å‹æ¶æ„ï¼‰ã€‚</li></ul></li><li><p><strong>è·¨åœ°åŸŸ/å…¨çƒåˆ†å¸ƒï¼ˆGeo-Distributedï¼‰</strong>ï¼š</p><ul><li>æ¯”å¦‚ 1 å°åœ¨çº½çº¦ï¼Œ1 å°åœ¨ä¼¦æ•¦ï¼Œ1 å°åœ¨ä¸œäº¬ï¼Œ2 å°åœ¨æ–°åŠ å¡ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½æŠµå¾¡æˆ˜äº‰ã€åœ°éœ‡ç­‰åŒºåŸŸæ€§ç¾éš¾ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šéå¸¸æ…¢ï¼å› ä¸ºå…‰é€Ÿé™åˆ¶ï¼ŒRaft è¾¾æˆå…±è¯†ï¼ˆå¤šæ•°æ´¾ç¡®è®¤ï¼‰å¯èƒ½éœ€è¦å‡ ç™¾æ¯«ç§’ã€‚Google çš„ <strong>Spanner</strong> æ•°æ®åº“å°±æ˜¯è¿™ç§æ¶æ„ã€‚</li></ul></li></ol><hr><h3 id="äºŒã€-åªæœ‰-put-å’Œ-get-æ€ä¹ˆç®¡ç†å‡ åƒå°-gpu" tabindex="-1"><a class="header-anchor" href="#äºŒã€-åªæœ‰-put-å’Œ-get-æ€ä¹ˆç®¡ç†å‡ åƒå°-gpu"><span>äºŒã€ åªæœ‰ <code>Put</code> å’Œ <code>Get</code>ï¼Œæ€ä¹ˆç®¡ç†å‡ åƒå° GPUï¼Ÿ</span></a></h3><p>è¿™å¬èµ·æ¥ä¸å¯æ€è®®ï¼Œä½†<strong>å…¨ä¸–ç•Œæœ€å¤æ‚çš„é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼ˆå¦‚ Kubernetesï¼‰æ­£æ˜¯è¿™ä¹ˆå¹²çš„ã€‚</strong></p><p>Kubernetes åº•å±‚ç”¨çš„æ˜¯ <strong>etcd</strong>ï¼Œè€Œ etcd æœ¬è´¨ä¸Šå’Œç°åœ¨å†™çš„ <strong>KV-Raft</strong> å‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚</p><h4 id="_1-å®ƒæ˜¯å¦‚ä½•é€šè¿‡ä¸¤ä¸ªæ–¹æ³•ç®¡ç†é›†ç¾¤çš„" tabindex="-1"><a class="header-anchor" href="#_1-å®ƒæ˜¯å¦‚ä½•é€šè¿‡ä¸¤ä¸ªæ–¹æ³•ç®¡ç†é›†ç¾¤çš„"><span>1. å®ƒæ˜¯å¦‚ä½•é€šè¿‡ä¸¤ä¸ªæ–¹æ³•ç®¡ç†é›†ç¾¤çš„ï¼Ÿ</span></a></h4><p>ç§˜è¯€åœ¨äºï¼š<strong>æ‰€æœ‰çš„ç®¡ç†æŒ‡ä»¤ï¼Œåœ¨æœ¬è´¨ä¸Šéƒ½æ˜¯â€œçŠ¶æ€çš„å˜åŒ–â€ã€‚</strong></p><ul><li><p><strong>åœºæ™¯ï¼šç»™ GPU 1 å·åˆ†é…ä¸€ä¸ª AI è®­ç»ƒä»»åŠ¡</strong></p><ul><li><strong>åŒ…å·¥å¤´ï¼ˆSchedulerï¼‰</strong> å¹¶ä¸éœ€è¦ç›´æ¥ç»™ GPU å‘æ¶ˆæ¯ã€‚</li><li><strong>åŒ…å·¥å¤´</strong> åªéœ€è°ƒç”¨ä½ çš„ <code>Put(&quot;GPU_001_Assignment&quot;, &quot;{task: &#39;Training_Cat_Model&#39;, data: &#39;s3://bucket/data&#39;}&quot;)</code>ã€‚</li><li><strong>GPU 1 å·</strong> ä¸Šçš„ Agent ç¨‹åºï¼ˆå°±åƒä¸€ä¸ª Clerkï¼‰ä¸€ç›´åœ¨åå°ä¸åœåœ°è°ƒä½ çš„ <code>Get(&quot;GPU_001_Assignment&quot;)</code>ï¼ˆè¿™ç§æŠ€æœ¯å«è½®è¯¢æˆ–é•¿è½®è¯¢ï¼‰ã€‚</li><li>ä¸€æ—¦ GPU å‘ç°å†…å®¹å˜äº†ï¼Œå®ƒå°±è‡ªå·±å»ä¸‹è½½æ•°æ®å¼€å§‹å¹²æ´»ã€‚</li></ul></li><li><p><strong>åœºæ™¯ï¼šGPU åäº†æ€ä¹ˆåŠï¼Ÿ</strong></p><ul><li>GPU ä¸Šçš„ Agent å®šæœŸè°ƒä½ çš„ <code>Put(&quot;GPU_001_Status&quot;, &quot;Healthy_12:00:05&quot;)</code>ã€‚</li><li><strong>åŒ…å·¥å¤´</strong> è°ƒ <code>Get(&quot;GPU_001_Status&quot;)</code>ã€‚å¦‚æœå‘ç°æ—¶é—´å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼ŒåŒ…å·¥å¤´å°±çŸ¥é“å®ƒæŒ‚äº†ï¼Œäºæ˜¯å†å‘ä¸€ä¸ª <code>Put</code> æŠŠä»»åŠ¡æŒ‡æ´¾ç»™åˆ«äººã€‚</li></ul></li></ul><h4 id="_2-ä¸ºä»€ä¹ˆåªç»™ä¸¤ä¸ªæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_2-ä¸ºä»€ä¹ˆåªç»™ä¸¤ä¸ªæ–¹æ³•"><span>2. ä¸ºä»€ä¹ˆåªç»™ä¸¤ä¸ªæ–¹æ³•ï¼Ÿ</span></a></h4><p>å› ä¸º <strong>â€œç®€å•å³åŠ›é‡â€</strong>ã€‚<br> å¦‚æœæ¥å£å¤ªå¤æ‚ï¼ˆæ¯”å¦‚åŒ…å« <code>StartTraining()</code>, <code>StopTraining()</code>ï¼‰ï¼Œé‚£ä¹ˆä½ çš„ KV-Raft å°±åªèƒ½ç”¨äº AI è®­ç»ƒã€‚<br> ä½†å¦‚æœä½ åªæä¾› <code>Put</code> å’Œ <code>Get</code>ï¼Œä½ å°±åˆ›é€ äº†ä¸€ä¸ª<strong>é€šç”¨çš„çœŸç†ä¹‹æº</strong>ã€‚å®ƒæ—¢å¯ä»¥ç®¡ç† GPU é›†ç¾¤ï¼Œä¹Ÿå¯ä»¥ç®¡ç†é“¶è¡Œè´¦æœ¬ï¼Œè¿˜å¯ä»¥ç®¡ç†è‡ªåŠ¨é©¾é©¶æ±½è½¦çš„è°ƒåº¦ã€‚</p><hr><h3 id="ä¸‰ã€-æ€»ç»“-è¿™ç§æ¶æ„çš„-å…¨å±€è§†è§’" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€-æ€»ç»“-è¿™ç§æ¶æ„çš„-å…¨å±€è§†è§’"><span>ä¸‰ã€ æ€»ç»“ï¼šè¿™ç§æ¶æ„çš„â€œå…¨å±€è§†è§’â€</span></a></h3><ol><li><p><strong>åº•å±‚ï¼šKV-Raft (å¤§è„‘)</strong><br> è¿™ 5 å°æœºå™¨ç¼©åœ¨æ•°æ®ä¸­å¿ƒçš„ä¸€ä¸ªå°è§’è½é‡Œã€‚å®ƒä»¬è™½ç„¶åªæœ‰ 5 å°ï¼Œä½†å®ƒä»¬é€šè¿‡ Raft ç®—æ³•äº§ç”Ÿäº†ä¸€ä¸ª <strong>â€œç»Ÿä¸€çš„å¹»è§‰â€</strong>ï¼šå¤§å®¶éƒ½çœ‹åˆ°ä¸€æ¨¡ä¸€æ ·çš„ <code>Put/Get</code> è®°å½•ã€‚</p></li><li><p><strong>ä¸­é—´å±‚ï¼šClerk (ç¥ç»æœ«æ¢¢)</strong><br> åˆ†å¸ƒåœ¨å…¨çƒå„åœ°çš„ 1000 å° GPU æœºå™¨ä¸Šï¼Œéƒ½è·‘ç€ä½ å†™çš„ <code>Clerk</code> ä»£ç ã€‚å®ƒä»¬åƒè§¦è§’ä¸€æ ·ï¼Œæ—¶åˆ»è¿æ¥ç€è¿™ 5 å°æ ¸å¿ƒæœºå™¨ã€‚</p></li><li><p><strong>è¿ä½œè¿‡ç¨‹ï¼š</strong></p><ul><li>æ— è®ºåœ°ç†åˆ†å¸ƒå¤šå¹¿ï¼Œæ‰€æœ‰çš„ GPU æœºå™¨éƒ½è®¤å‡†è¿™ 5 å°æœºå™¨ã€‚</li><li>å½“ Leader å‘ç”Ÿåˆ‡æ¢ï¼Œå…¨çƒå„åœ°çš„ <code>Clerk</code> ä¼šè‡ªåŠ¨é‡å®šå‘è¯·æ±‚ã€‚</li><li><strong>åœ°ç†å¹¿åº¦</strong>ç”± <code>Clerk</code> è´Ÿè´£è¿æ¥ï¼Œ<strong>æ•°æ®çš„ä¸€è‡´æ€§</strong>ç”±ä½ çš„ 5 å°æœºå™¨è´Ÿè´£æ­»å®ˆã€‚</li></ul></li></ol><h1 id="kvraft-å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#kvraft-å®æˆ˜"><span>KVRAFT å®æˆ˜</span></a></h1><h2 id="clerk-client" tabindex="-1"><a class="header-anchor" href="#clerk-client"><span>Clerk/Client</span></a></h2><p>è¿™ä¸ªéƒ¨åˆ†åªéœ€è¦å®Œæˆå‘kvserverå‘é€çš„RPCæ„å»º<br> éœ€è¦æ³¨æ„çš„æ˜¯</p><ul><li>éœ€è¦å‘æ‰€æœ‰å¯èƒ½çš„serverè¿›è¡Œè¯¢é—® ç›´åˆ°æ‰¾åˆ°leader kvserveræ‰è¡Œ å¯ç”¨æ€§æ–¹é¢æ˜¯raftä¿è¯çš„</li><li>éœ€è¦ç»´æŠ¤clinet id å’Œ seq no æ¥ä¿è¯å„ç§æ“ä½œçš„çº¿æ€§ä¸€è‡´æ€§å’Œå¹‚ç­‰æ€§ï¼ˆå¦‚æœæœåŠ¡å™¨å‘ç°seqnoå·²ç»è¿‡æ—¶äº† å°±ä¸ä¼šåœ¨ä»–çš„çŠ¶æ€æœºä¸Šåº”ç”¨äº†ï¼‰</li></ul><h2 id="kvserver" tabindex="-1"><a class="header-anchor" href="#kvserver"><span>KVserver</span></a></h2><p>KVserver å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ‰§è¡Œè€… æœ¬è´¨ä¸Šå°±æ˜¯ç»´æŠ¤äº†ä¸€ä¸ªå†…å­˜é‡Œçš„map ç„¶åèƒ½å¤Ÿæ¥å—ä¸‰ç§æŒ‡ä»¤ GET PUT APPEND<br> è€Œraftä¸ç†è§£è¿™ä¸ªæŒ‡ä»¤ ä»–çœ¼é‡Œåªæœ‰å­—èŠ‚æµæ—¥å¿— å¹¶ä¸”ä»–ä¿è¯è¿™ä¸ªæ—¥å¿—åœ¨æ‰€æœ‰æœºå™¨ä¸­è¾¾æˆå…±è¯†<br> ä¸€æ—¦raftæŠŠè¿™ä¸ªæ—¥å¿—æˆåŠŸå¤åˆ¶ç»™åŠæ•°èŠ‚ç‚¹ ä»–å°±ä¼šé€šè¿‡apply channelå‘Šè¯‰KVserver ä½ å¯ä»¥æ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤äº†</p><p>å¦‚æœä¸é€šè¿‡ Raft ç»™æŒ‡ä»¤ï¼Œè€Œæ˜¯ KVServer æ”¶åˆ°è¯·æ±‚ç›´æ¥æ”¹ mapï¼š</p><ul><li>Server 1 æ”¶åˆ° Put(a, 1)ï¼Œæ”¹äº† mapã€‚</li><li>Server 2 æ²¡æ”¶åˆ°ï¼Œå®ƒçš„ map è¿˜æ˜¯æ—§çš„ã€‚<br><strong>ç»“æœ</strong>ï¼šä¸¤ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€ä¸ä¸€æ ·äº†ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå´©æºƒã€‚<br> é€šè¿‡ Raft ç»™æŒ‡ä»¤çš„é€»è¾‘æ˜¯ï¼š</li><li>å®¢æˆ·ç«¯æ‰¾ Server 1 è¯´ï¼šæˆ‘æƒ³ Put(a, 1)ã€‚</li><li>Server 1 ä¸æ•¢ç›´æ¥æ”¹ mapï¼Œå®ƒå…ˆé—® Raftï¼šæŠŠè¿™ä¸ªè®°åœ¨è´¦æœ¬ä¸Šè¡Œä¸è¡Œï¼Ÿ</li><li>Raft å‘Šè¯‰ Server 1ã€2ã€3ï¼šå¤§å®¶éƒ½è®°å¥½äº†ï¼ŒIndex 100 æ˜¯ Put(a, 1)ã€‚</li><li>Server 1ã€2ã€3 çš„ applyLoop éƒ½ä» Raft é‚£é‡Œæ‹¿åˆ°äº†è¿™æ¡æŒ‡ä»¤ã€‚</li><li>å¤§å®¶åŒæ—¶æ”¹ mapã€‚<br><strong>ç»“æœ</strong>ï¼šå…¨ä¸–ç•Œçš„ map æ°¸è¿œä¿æŒåŒæ­¥ã€‚</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>èŠ‚ç‚¹ 1                     èŠ‚ç‚¹ 2                     èŠ‚ç‚¹ 3</span></span>
<span class="line"><span>+--------------+          +--------------+          +--------------+</span></span>
<span class="line"><span>|   KVServer   |          |   KVServer   |          |   KVServer   |</span></span>
<span class="line"><span>+--------------+          +--------------+          +--------------+</span></span>
<span class="line"><span>|     Raft     | &lt;------&gt; |     Raft     | &lt;------&gt; |     Raft     |</span></span>
<span class="line"><span>+--------------+          +--------------+          +--------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åªæœ‰ Leader èº«ä»½çš„ KVServer ä¼šå¤„ç† Client çš„è¯·æ±‚ã€‚</strong></p><ul><li><strong>Client çš„è§†è§’</strong>ï¼šClient ä¼šè½®è¯¢æœåŠ¡å™¨ã€‚å¦‚æœå®ƒå‘ä¸€ä¸ª Follower å‘é€è¯·æ±‚ï¼Œè¿™ä¸ª KVServer ä¼šçœ‹ä¸€çœ¼å®ƒå†…éƒ¨çš„ Raft çŠ¶æ€ï¼Œè¯´ï¼šâ€œæˆ‘ä¸æ˜¯ Leaderï¼Œä½ å»é—®èŠ‚ç‚¹ Xâ€ã€‚</li><li><strong>å†™æ“ä½œ (Put/Append)</strong>ï¼šå¿…é¡»ç”± Leader æäº¤åˆ° Raft æ—¥å¿—ï¼Œç­‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹ç¡®è®¤åæ‰èƒ½ä¿®æ”¹æ•°æ®åº“ã€‚</li><li><strong>è¯»æ“ä½œ (Get)</strong>ï¼šä¸ºäº†ä¿è¯è¯»åˆ°çš„æ˜¯æœ€æ–°çš„ï¼ŒLeader ä¹Ÿéœ€è¦æŠŠ Get ä½œä¸ºä¸€ä¸ªæ—¥å¿—èµ°ä¸€é Raft æµç¨‹ï¼ˆæˆ–è€…ä½¿ç”¨æ›´é«˜çº§çš„ Read Index æœºåˆ¶ï¼‰ï¼Œç¡®ä¿å®ƒåœ¨æ‰§è¡Œè¯»çš„ä¸€åˆ»ä¾ç„¶æ˜¯ Leaderã€‚</li></ul><h3 id="kvserver-å’Œ-raft-çš„äº¤äº’æµç¨‹" tabindex="-1"><a class="header-anchor" href="#kvserver-å’Œ-raft-çš„äº¤äº’æµç¨‹"><span>KVServer å’Œ Raft çš„äº¤äº’æµç¨‹</span></a></h3><p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„â€œå¼‚æ­¥è½¬åŒæ­¥â€çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>æè®® (Proposal)</strong>ï¼š <ul><li>Client è°ƒç”¨Â Put(key, val)ã€‚</li><li>KVServer æ”¶åˆ°åï¼Œè°ƒç”¨Â rf.Start(op)ã€‚</li><li>Raft è¯´ï¼šâ€œå¥½ï¼Œæˆ‘æŠŠå®ƒè®°åœ¨æˆ‘çš„æ—¥å¿—ç¬¬ 100 å·ä½ç½®äº†ï¼Œä½†æˆ‘è¿˜æ²¡ç¡®å®šå®ƒèƒ½ä¸èƒ½ç”Ÿæ•ˆã€‚â€</li></ul></li><li><strong>å¤åˆ¶ (Replication)</strong>ï¼š <ul><li>Leader çš„ Raft å¼€å§‹ç–¯ç‹‚ç»™å…¶ä»–èŠ‚ç‚¹çš„ Raft å‘æ¶ˆæ¯ï¼šâ€œå¤§å®¶å¿«æŠŠè¿™è¡Œå­—è®°åœ¨ç¬¬ 100 å·ä½ç½®ï¼â€</li></ul></li><li><strong>æäº¤ä¸åº”ç”¨ (Commit &amp; Apply)</strong>ï¼š <ul><li>å½“åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹è®°å¥½äº†ï¼ŒLeader çš„ Raft å°±ä¼šè®¤ä¸ºç¬¬ 100 å·æ—¥å¿—å·²æäº¤ã€‚</li><li><strong>å…³é”®ç‚¹</strong>ï¼šRaft é€šè¿‡Â applyChÂ å‘Šè¯‰ KVServerï¼šâ€œç¬¬ 100 å·æ—¥å¿—ç°åœ¨å®‰å…¨äº†ï¼Œä½ å¯ä»¥æ‰§è¡Œå®ƒäº†ã€‚â€</li></ul></li><li><strong>å“åº” (Reply)</strong>ï¼š <ul><li>KVServer çš„Â applierÂ åç¨‹ä»Â applyChÂ æ‹¿åˆ°æ¶ˆæ¯ï¼Œä¿®æ”¹Â kv.dbã€‚</li><li>KVServer æ‰¾åˆ°æ­£åœ¨ç­‰ 100 å·ç´¢å¼•çš„é‚£ä¸ª RPC Handlerï¼Œé€šè¿‡Â waitChÂ å–Šä¸€å£°ï¼šâ€œå–‚ï¼åšå¥½äº†ï¼â€</li><li>RPC Handler å›å¤ Clientï¼šâ€œæˆåŠŸï¼â€</li></ul></li></ol><h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿæœ€éš¾çš„å°±æ˜¯-å‡ºäº‹çš„æ—¶å€™-ã€‚" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼ç³»ç»Ÿæœ€éš¾çš„å°±æ˜¯-å‡ºäº‹çš„æ—¶å€™-ã€‚"><span>åˆ†å¸ƒå¼ç³»ç»Ÿæœ€éš¾çš„å°±æ˜¯â€œå‡ºäº‹çš„æ—¶å€™â€ã€‚</span></a></h3><h4 id="æƒ…å†µ-a-leader-çªç„¶æ–­ç½‘-å®•æœºäº†" tabindex="-1"><a class="header-anchor" href="#æƒ…å†µ-a-leader-çªç„¶æ–­ç½‘-å®•æœºäº†"><span>æƒ…å†µ Aï¼šLeader çªç„¶æ–­ç½‘/å®•æœºäº†</span></a></h4><ul><li><strong>Raft å±‚</strong>ï¼šå…¶ä»–èŠ‚ç‚¹ä¼šå‘ç° Leader æ¶ˆå¤±äº†ï¼Œè‡ªåŠ¨é€‰å‡ºæ–° Leaderã€‚</li><li><strong>KVServer å±‚</strong>ï¼šæ—§ Leader çš„ Handler è¿˜åœ¨ç­‰Â waitChã€‚ç”±äºå®ƒä¸å†æ˜¯ Leaderï¼Œå®ƒçš„ Raft æ°¸è¿œä¸ä¼šåœ¨Â applyChÂ é‡Œè¿”å›é‚£ä¸ªç´¢å¼•ã€‚Handler ä¼š<strong>è¶…æ—¶</strong>ï¼ˆè¿™å°±æ˜¯ä½ ä»£ç é‡ŒÂ time.AfterÂ çš„ä½œç”¨ï¼‰ï¼Œå¹¶å‘Šè¯‰ Clientï¼šâ€œå‡ºäº‹äº†ï¼Œä½ å»é—®åˆ«äººå§ã€‚â€</li></ul><h4 id="æƒ…å†µ-b-ç½‘ç»œåˆ†åŒº-è„‘è£‚" tabindex="-1"><a class="header-anchor" href="#æƒ…å†µ-b-ç½‘ç»œåˆ†åŒº-è„‘è£‚"><span>æƒ…å†µ Bï¼šç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰</span></a></h4><ul><li>å‡è®¾æœ‰ 5 ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ 1 å’Œ 2 è¢«éš”ç¦»äº†ã€‚èŠ‚ç‚¹ 1 è§‰å¾—è‡ªå·±è¿˜æ˜¯ Leaderã€‚</li><li>Client å‘èŠ‚ç‚¹ 1 å‘è¯·æ±‚ã€‚èŠ‚ç‚¹ 1 è°ƒç”¨Â rf.Start()ã€‚</li><li>ä½†æ˜¯ï¼ç”±äºå®ƒåªèƒ½è”ç»œåˆ°èŠ‚ç‚¹ 2ï¼Œå‡‘ä¸å¤Ÿ 3 ç¥¨ï¼ˆåŠæ•°ï¼‰ï¼Œè¿™ä¸ªæ—¥å¿—æ°¸è¿œæ— æ³•Â <strong>Commit</strong>ã€‚</li><li>Client ä¼šä¸€ç›´ç­‰ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¿è¯äº†<strong>æ•°æ®ä¸ä¼šåœ¨é”™è¯¯çš„åˆ†åŒºé‡Œè¢«ä¿®æ”¹</strong>ã€‚</li></ul><h4 id="æƒ…å†µ-c-æ—§æŒ‡ä»¤å»¶è¿Ÿåˆ°è¾¾" tabindex="-1"><a class="header-anchor" href="#æƒ…å†µ-c-æ—§æŒ‡ä»¤å»¶è¿Ÿåˆ°è¾¾"><span>æƒ…å†µ Cï¼šæ—§æŒ‡ä»¤å»¶è¿Ÿåˆ°è¾¾</span></a></h4><ul><li>å¦‚æœä¸€ä¸ªÂ AppendÂ æŒ‡ä»¤å› ä¸ºç½‘ç»œå»¶è¿Ÿï¼Œåœ¨ 10 ç§’åæ‰åˆ°è¾¾ã€‚</li><li>KVServer ä¼šæ£€æŸ¥Â lastAppliedÂ è¡¨ã€‚å¦‚æœå‘ç°è¿™ä¸ªå®¢æˆ·ç«¯çš„åºåˆ—å·ï¼ˆSeqNoï¼‰å·²ç»å¤„ç†è¿‡äº†ï¼Œå®ƒå°±ä¼š<strong>ç›´æ¥ä¸¢å¼ƒ</strong>è¿™ä¸ªæ“ä½œï¼Œä¸ä¿®æ”¹æ•°æ®åº“ï¼Œä½†ä¼šè¿”å›Â OKï¼ˆå¹‚ç­‰æ€§ï¼‰ã€‚</li></ul><h3 id="å…¨éƒ¨æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å…¨éƒ¨æµç¨‹"><span>å…¨éƒ¨æµç¨‹</span></a></h3><ol><li><strong>Client -&gt; KVServer (RPC Handler)</strong>: <ul><li><code>Handler</code> åˆ›å»º <code>Op{Type: Append, Key: &quot;a&quot;, Val: &quot;1&quot;, ClerkId: 88, SeqNo: 5}</code>ã€‚</li><li>è°ƒç”¨ <code>index, term, isLeader := rf.Start(op)</code>ã€‚</li><li><code>Handler</code> åˆ›å»º <code>ch := make(chan Op, 1)</code> å¹¶å­˜å…¥ <code>waitChs[index]</code>ã€‚</li></ul></li><li><strong>KVServer -&gt; Raft (Log Replication)</strong>: <ul><li>Raft åœ¨é›†ç¾¤é—´åŒæ­¥è¿™æ¡æ—¥å¿—ã€‚</li><li>æ­¤æ—¶ <code>Handler</code> æ­£åœ¨ <code>select { case &lt;-ch: ... }</code> å¤„é˜»å¡ã€‚</li></ul></li><li><strong>Raft -&gt; KVServer (Applier Loop)</strong>: <ul><li>Raft è¾¾æˆå…±è¯†ï¼ŒæŠŠ <code>ApplyMsg{CommandIndex: 100, Command: Op{...}}</code> å¡å…¥ <code>applyCh</code></li><li><code>Applier</code> åç¨‹è¯»åˆ°è¿™æ¡æ¶ˆæ¯ã€‚</li></ul></li><li><strong>KVServer å†…éƒ¨çŠ¶æ€æ›´æ–°</strong>: <ul><li><code>Applier</code> æ£€æŸ¥ <code>lastApplied[88]</code>ã€‚å¦‚æœå½“å‰è®°å½•çš„åºå·å°äº 5ï¼Œåˆ™æ‰§è¡Œ <code>db[&quot;a&quot;] += &quot;1&quot;</code>ã€‚</li><li>æ‰§è¡Œå®Œåï¼Œ<code>Applier</code> æŸ¥æ‰¾ <code>waitChs[100]</code>ã€‚</li><li><strong>å…³é”®åŠ¨ä½œ</strong>ï¼š<code>Applier</code> æŠŠ <code>Op</code> å‘è¿› <code>ch</code>ã€‚</li></ul></li><li><strong>KVServer -&gt; Client (RPC Response)</strong>: <ul><li><code>Handler</code> è¢«å”¤é†’ï¼Œæ”¶åˆ° <code>Op</code>ã€‚</li><li>æ£€æŸ¥æ”¶åˆ°çš„ <code>Op</code> æ˜¯å¦è¿˜æ˜¯ <code>ClerkId=88, SeqNo=5</code>ï¼ˆé˜²æ­¢ Index 100 å·²ç»è¢«æ–° Leader çš„å…¶ä»–å‘½ä»¤è¦†ç›–ï¼‰ã€‚</li><li>æ ¡éªŒé€šè¿‡ï¼Œç»™ Client å›å¤ <code>OK</code>ã€‚</li></ul></li></ol><hr><h4 id="ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡é€šä¿¡"><span>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡é€šä¿¡ï¼Ÿ</span></a></h4><p>è¿™ç§è®¾è®¡å®Œç¾è§£å†³äº†åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ä¸‰ä¸ªåœ°é›·ï¼š</p><ol><li><strong>è§£è€¦ (Decoupling)</strong>ï¼š<br> KVServer ä¸éœ€è¦çŸ¥é“ Raft æ˜¯æ€ä¹ˆåŒæ­¥æ—¥å¿—çš„ï¼Œå®ƒåªéœ€è¦ç»™ Raft ä¸€ä¸ªä»»åŠ¡ï¼Œç„¶åç­‰ Raft çš„å›æ‰§ã€‚</li><li><strong>çº¿æ€§åŒ– (Linearizability)</strong>ï¼š<br> å› ä¸º <code>Applier</code> æ˜¯å•çº¿ç¨‹ï¼ˆä¸€ä¸ªåç¨‹ï¼‰å¤„ç† <code>applyCh</code> çš„ï¼Œè¿™ä¿è¯äº†æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡ŒæŒ‡ä»¤çš„<strong>é¡ºåºå®Œå…¨ä¸€è‡´</strong>ã€‚å³ä¾¿æœ‰ 100 ä¸ª Handler åŒæ—¶åœ¨è·‘ï¼Œæœ€ç»ˆæ”¹æ•°æ®åº“çš„é¡ºåºä¹Ÿåªå–å†³äº Raft æ—¥å¿—çš„é¡ºåºã€‚</li><li><strong>å®‰å…¨æ€§ (Safety)</strong>ï¼š<br> å³ä½¿ Leader åœ¨åŒæ­¥è¿‡ç¨‹ä¸­æŒ‚äº†ï¼Œç”±äº Handler æ ¡éªŒäº† <code>ClerkId</code> å’Œ <code>SeqNo</code>ï¼Œå®ƒèƒ½æ•é”åœ°å‘ç°ï¼šâ€œRaft ç¡®å®è¿”å›äº† Index 100 çš„ç»“æœï¼Œä½†é‚£ä¸ªç»“æœä¸æ˜¯æˆ‘ä¹‹å‰è¦å­˜çš„â€˜1â€™ï¼Œè€Œæ˜¯åˆ«äººå­˜çš„â€˜2â€™ã€‚â€ è¿™æ ·å®ƒå°±ä¸ä¼šç»™å®¢æˆ·ç«¯è¿”å›é”™è¯¯çš„æˆåŠŸä¿¡æ¯ã€‚</li></ol></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/yedou37/yedou37.github.io/edit/main/src/courses/6.5840.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">æœ€è¿‘æ›´æ–°: </span><time class="vp-meta-info" datetime="2026-01-28T11:30:46.000Z" data-allow-mismatch>2026/1/28 11:30</time></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 137401103+yedou37@users.noreply.github.com">yedou37</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">è®°å½•é¢è¯•å¤ä¹  & è¯¾ç¨‹å¤§ä½œä¸š</div><div class="vp-copyright">Copyright Â© 2026 yedou </div></footer></div><!--]--><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-f5bTKqOW.js" defer></script>
  </body>
</html>
